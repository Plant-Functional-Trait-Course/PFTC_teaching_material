<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3 Resources | PFTC Teaching Material</title>
<meta name="author" content="Aud Halbritter">
<meta name="description" content="This page contains resources for: What to consider before going to the field data collection measurements data curation data analysis We provide protocols, important literature, tutorials,...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="3 Resources | PFTC Teaching Material">
<meta property="og:type" content="book">
<meta property="og:description" content="This page contains resources for: What to consider before going to the field data collection measurements data curation data analysis We provide protocols, important literature, tutorials,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3 Resources | PFTC Teaching Material">
<meta name="twitter:description" content="This page contains resources for: What to consider before going to the field data collection measurements data curation data analysis We provide protocols, important literature, tutorials,...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.12/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style-chapters.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">PFTC Teaching Material</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">PFTC Teaching material</a></li>
<li><a class="" href="the-study-system.html"><span class="header-section-number">1</span> The study system</a></li>
<li><a class="" href="pftc-6-course-information.html"><span class="header-section-number">2</span> PFTC 6 Course information</a></li>
<li><a class="active" href="resources.html"><span class="header-section-number">3</span> Resources</a></li>
<li><a class="" href="group-projects.html"><span class="header-section-number">4</span> Group projects</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="resources" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Resources<a class="anchor" aria-label="anchor" href="#resources"><i class="fas fa-link"></i></a>
</h1>
<p>This page contains resources for:</p>
<ul>
<li>What to consider before going to the field</li>
<li>data collection</li>
<li>measurements</li>
<li>data curation</li>
<li>data analysis</li>
</ul>
<p>We provide protocols, important literature, tutorials, databases, and code.</p>

<div id="field-based-data-collection" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Field based data collection<a class="anchor" aria-label="anchor" href="#field-based-data-collection"><i class="fas fa-link"></i></a>
</h2>
<div id="what-to-think-about-before-going-to-the-field" class="section level3" number="3.1.1">
<h3>
<span class="header-section-number">3.1.1</span> What to think about before going to the field<a class="anchor" aria-label="anchor" href="#what-to-think-about-before-going-to-the-field"><i class="fas fa-link"></i></a>
</h3>
<p>something…</p>

</div>
</div>
<div id="how-to-measure-plant-functional-traits" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> How to measure plant functional traits?<a class="anchor" aria-label="anchor" href="#how-to-measure-plant-functional-traits"><i class="fas fa-link"></i></a>
</h2>
<p>This protocol is based on the trait handbook from Perez-Harguindeguy et al. <span class="citation">(2013)</span>.</p>
<p>This protocol shows how to measure leaf functional traits and was adapted for the traits wheel<sup>TW</sup> in the PFTC courses.</p>
<div class="figure">
<span style="display:block;" id="fig:trait-wheel"></span>
<img src="images/trait_wheel/TraitWheel_small.png" alt="The different stages from collection, processing and curating data from the trait wheel." width="100%"><p class="caption">
Figure 3.1: The different stages from collection, processing and curating data from the trait wheel.
</p>
</div>
<div class="inline-figure"><img src="images/trait_wheel/Collect.png" width="10%"></div>
<p><strong>A Sampling individual plants in the field (Intraspecific group)</strong></p>
<p><em>This protocol needs to be checked by group 1</em>
Are plants collected inside plots or not? Uprooted or not? How many leaves etc.</p>
<p>Follow the species list for our group, starting with the highest priority species for each site.
DO NOT collect plants from within the plots or the trampled zone around the plots.
Find 10 individuals of each species, ideally each individual should have five leaves, but three leaves is a minimum.
Each individual should be at least two meters away from each other, to avoid sampling individuals from the same genetic individual.
Choose reproductively mature adults with fully expanded leaves (i.e. not seedlings).
Choose individuals with healthy-looking leaves (i.e. not grazed, no signs of pathogen or herbivore attack, no discoloration).
Before uprooting the individual, measure its height (see below).
For very large individuals that are too large to uproot (e.g. ferns), collect 5 leaves from the individual, making sure to include the petiole.
If you are uncertain whether something is a leaf vs. leaflet, ask your group leader.
If you cannot find 10 individuals of each species, that is ok.
After a reasonable search, move on.</p>
<p><strong>B Sampling individual plants in the field (Global change group):</strong></p>
<p>Be careful at all time when working in the experiment, because there are plots everywhere and we want to avoid stepping on the plots.
Go to your plot, collect your data and minimize trampling as much as possible.</p>
<p>We will sample the most common species for each plot and you are provided with a species list for each plot.
Each plot has a inner and outer zone (see Figure <a href="resources.html#fig:plot">3.2</a>).
The inner zone should stay untouched if possible and the leaves should be collected from the outer zone.</p>
<div class="figure">
<span style="display:block;" id="fig:plot"></span>
<img src="images/sites/ExperimentalDesign.jpg" alt="Experimental design (left) and organization of the plot (right)." width="100%"><p class="caption">
Figure 3.2: Experimental design (left) and organization of the plot (right).
</p>
</div>
<p>Each plot is marked with metal tubes in each corner and a label on the top.
Find 3-5 individuals of each species per plot.
Choose reproductively mature adults with fully expanded leaves (i.e. not seedlings).
Choose individuals with healthy-looking leaves (i.e. not grazed, no signs of pathogen or herbivore attack, no discoloration).
Measure the height of each individual (see below).
Collect up to 5 leaves from the individual, making sure to include the petiole see Figure <a href="resources.html#fig:petiol">3.3</a>.
If you are uncertain whether something is a leaf vs. leaflet, ask your group leader.
If you cannot find 5 individuals of each species, that is ok.
After a reasonable search, move on.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:petiol"></span>
<img src="images/trait_wheel/leaf_anatomy_1.png" alt="Leaf anatomy" width="49%" height="20%"><img src="images/trait_wheel/leaf_anatomy_2.png" alt="Leaf anatomy" width="49%" height="20%"><p class="caption">
Figure 3.3: Leaf anatomy
</p>
</div>
<p><strong>Measuring height of individual plants in the field:</strong></p>
<p>Record the height of the individual plant.
Measure the tallest point of the individual plant, excluding fruits and flowers.
Do not stretch the plant if it bends (see Figure <a href="resources.html#fig:height">3.4</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:height"></span>
<img src="images/trait_wheel/height_1.png" alt="Leaf anatomy" width="49%" height="20%"><img src="images/trait_wheel/height_2.png" alt="Leaf anatomy" width="49%" height="20%"><p class="caption">
Figure 3.4: Leaf anatomy
</p>
</div>
<p>Record this measurement legibly (see Figure <a href="resources.html#fig:numbers">3.5</a> for how to write numbers) on flagging tape.
Tie the flagging tape around the individual securely and place individual in bag with wet paper towels for transfer to lab.</p>
<div class="figure">
<span style="display:block;" id="fig:numbers"></span>
<img src="images/trait_wheel/numbers.png" alt="The one and only approved way to write numbers! " width="100%"><p class="caption">
Figure 3.5: The one and only approved way to write numbers!
</p>
</div>
<div class="inline-figure"><img src="images/trait_wheel/Process.png" width="20%"></div>
<p><strong>Preparing leaves for measuring traits in lab:</strong></p>
<p>Select one (for the global change group) or five (for the intraspecific group) healthy, mature, undamaged, sun leaf/leaves per individual.
For analysing chemical traits such as percent P, C, N and isotopes, a certain amount of dry biomass is needed.
Make sure that we are collecting 0.03 g (30 mg) dried leaf material.
Otherwise select several leaves until there is enough dry weight (bulk sample).</p>
<p>Do we have special cases in Norway???
If a species does not have leaves, e.g. Baccharis (wings), we will collect a certain length of the stem.Please note on the envelope how much leaf material that was selected (in cm).</p>
<p>When collecting the leaf, include petiole and rachis (see Figure <a href="resources.html#fig:petiol">3.3</a>).
Pat the leaf dry with a tissue if there is visible water on the surface.
Add a barcode and a sticker to the envelope.
Attach the sticker with a stapler.
Fill in all information between ‘collection day’ and ‘Bulk nr/length’, see Figure <a href="resources.html#fig:label">3.6</a> below.
Check table below for options for the information.
Place the leaf inside the envelope
Put the envelope in a box for the next step.
Make sure the envelopes are kept wet at all times.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:label"></span>
<img src="images/trait_wheel/label.png" alt="Sticker and barcode example" width="49%" height="20%"><img src="images/trait_wheel/barcode.gif" alt="Sticker and barcode example" width="49%" height="20%"><p class="caption">
Figure 3.6: Sticker and barcode example
</p>
</div>
<p><em>What to write on the envelope</em></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">What to fill in</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">Three-D</td>
</tr>
<tr class="even">
<td align="left">Collection day</td>
<td align="left">add day, e.g. 24</td>
</tr>
<tr class="odd">
<td align="left">Site</td>
<td align="left">Vik, Joa, Lia</td>
</tr>
<tr class="even">
<td align="left">Elevation</td>
<td align="left">469, 920, 1290</td>
</tr>
<tr class="odd">
<td align="left">Genus</td>
<td align="left">Bistorta</td>
</tr>
<tr class="even">
<td align="left">Species</td>
<td align="left">vivipara</td>
</tr>
<tr class="odd">
<td align="left">Project</td>
<td align="left">Trait = group 1 + 2, Sean = group 3, Drone = group 5</td>
</tr>
<tr class="even">
<td align="left">Experiment</td>
<td align="left">ambient, warm, N level, grazing</td>
</tr>
<tr class="odd">
<td align="left">PlotID</td>
<td align="left">turfID, e.g. 2 W5M 125</td>
</tr>
<tr class="even">
<td align="left">Individual Nr</td>
<td align="left">numeric value</td>
</tr>
</tbody>
</table></div>
<div class="inline-figure"><img src="images/trait_wheel/Wet.png" width="15%"></div>
<p><strong>Wet mass</strong></p>
<p>Make sure the envelopes are still kept wet.
Weigh each leaf and write the weight on envelope, including all digits.</p>
<div class="inline-figure"><img src="images/trait_wheel/Scan.png" width="15%"></div>
<p><strong>Measure leaf area using a scanner</strong></p>
<p><em>Start setup</em></p>
<p>Connect your Laptop to the Raspberry PI.
Connect the PI with an ethernet cable to your laptop.
Connect the scanner to the PI.
Connect the barcode scanner to the PI.
Connect the power cable to the PI.</p>
<p>Wait for one minute.</p>
<p>Open VNC Viewer and type in the IP address corresponding to your PI:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">PI</th>
<th align="left">IP address</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">obi wan</td>
<td align="left">169.254.109.180</td>
</tr>
<tr class="even">
<td align="left">yoda</td>
<td align="left">169.254.160.193</td>
</tr>
<tr class="odd">
<td align="left">bb 8</td>
<td align="left">169.254.54.188</td>
</tr>
<tr class="even">
<td align="left">3 cpo</td>
<td align="left">169.254.247.22</td>
</tr>
<tr class="odd">
<td align="left">darth vader</td>
<td align="left">169.254.178.187</td>
</tr>
<tr class="even">
<td align="left">r2 d2</td>
<td align="left">169.254.231.2</td>
</tr>
<tr class="odd">
<td align="left">Deathstar</td>
<td align="left">169.254.152.80</td>
</tr>
<tr class="even">
<td align="left">Mr. Spock</td>
<td align="left">169.254.204.207</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">connect with phone</td>
<td align="left">192.168.42.42</td>
</tr>
</tbody>
</table></div>
<p>Spare SD card has the same as the pi it is in!</p>
<p>You will be asked to type in a username and password:</p>
<p>Username: pi</p>
<p>Password: pftc</p>
<p>Resize the screen for convenience.</p>
<p><em>Scan leaves</em></p>
<p>Make sure the envelopes are still kept wet.
Check that the scanner is clean and free of debris.
Clean if needed.
Place wet leaf face-down on the scanner.
Make sure the leaf is not folded and that leaflets do not overlap.
The leaf should not go all the way to the edge of the scanner, because each picture will be cropped.
You can cut the leaf into several pieces if needed, but please make a remark if you do so (e.g. cut 3).
You can tape the leaf to the scanner if it folds (e.g. grasses).</p>
<p>For graminoids (grasses, sedges, rushes):
Spread graminoid blades flat and tape to scanner if necessary to hold them in place</p>
<p>Exclude the leaf sheath (see Figure <a href="resources.html#fig:leaf">3.7</a>).</p>
<div class="figure">
<span style="display:block;" id="fig:leaf"></span>
<img src="images/trait_wheel/leaf.jpeg" alt="Leaf blade and sheats" width="40%"><p class="caption">
Figure 3.7: Leaf blade and sheats
</p>
</div>
<p><em>Scan, save and check the leaf</em></p>
<p>Click on the leaf icon (only needs to be done the first time).
This will start the scanning program.
If the scanner cannot be found, wait for a bit and try again.
Check the settings of the scanner.
These should be set as standard, so please do not touch them if not needed.</p>
<p>The scan should be:</p>
<ul>
<li>saved in Desktop/leaf_scans/</li>
<li>Type: JPEG</li>
<li>Colour</li>
<li>Full colour range</li>
<li>300dpi</li>
</ul>
<p>From here, do this for each leaf:</p>
<p>Press scan (at the bottom of the window) and a couple of seconds wait until the scanning process is done.
A new window will pop up.
Adjust the zoom to see the full picture (about 25%).
Check the quality of the scan (has the whole leaf been scanned, is the leaf not upside down, dirt on the scan, etc.).
If the scan is not ok, adjust the leaf and repeat the scan.
Click on the green save button to save the scan.
Make sure the cursor marks the filename (should be default).
Scan the barcode on the envelope of the leaf that has been scanned with the barcode reader.
The filename should be something like: AAA4667 (3 letters, 4 digits)
When the scan is saved, the PI will check that the LeafID and that the scanning settings (dpi, etc.) are correct.
If anything is wrong, it will open a window with an error message see Figure <a href="resources.html#fig:error">3.8</a>.
Please read it!</p>
<div class="figure">
<span style="display:block;" id="fig:error"></span>
<img src="images/trait_wheel/error.png" alt="Error message." width="50%"><p class="caption">
Figure 3.8: Error message.
</p>
</div>
<p>Click anywhere in the window and it will disappear.
Save the scan with the correct name or scan the leaf again if the settings are wrong.
MAKE SURE TO DELETE THE SCAN WITH THE WRONG NAME OR SETTING.
Tick the box on the envelope that the leaf has been scanned.
Make sure the scanned leaves are kept wet and move them to the next station.</p>
<p>From time to time:</p>
<p>When you are finished with scanning click on the yoda icon.
This will check the leafIDs.
If anything is wrong it will open a window and indicate which scans are wrong.
Make sure to fix all the wrong leafIDs and not to have duplicate scans before leaving the station.</p>
<p>Before leaving the station:</p>
<p>Copy all the scans onto a stick and deposit them on the PFTC6 hard drive.
Shut down the pi.
Wait 1 min to disconnect it from the power.</p>
<div class="inline-figure"><img src="images/trait_wheel/Thickness.png" width="18%"></div>
<p><strong>Leaf thickness</strong></p>
<p>Make sure the envelopes are still kept wet.
Thickness varies over the surface of the leaf; generally, the leaf is thickest at the midrib, primary veins, margins, and leaf base.
Avoid the midrib when measuring leaf thickness, unless the leaf is too small.
Take three thickness measurements at several points on the lamina.
From this, we will later calculate the average thickness.
If the leaf is small, it may not be possible to take three unique measurements.</p>
<div class="inline-figure"><img src="images/trait_wheel/veins.jpg" width="40%"></div>
<p>Ferns: Make sure you do not measure thickness on the spore-producing sori on the lower side of fern frond.</p>
<div class="inline-figure"><img src="images/trait_wheel/Data.png" width="15%"></div>
<p><strong>Data entry</strong></p>
<p>Ideally the envelope should still be kept wet until this point in case any information is missing.
Open up the google sheet (link) onto your computer.
Connect a barcode scanner to your computer.
Scan the barcode of an envelope.
Make sure that your cursor is in the right cell (ID).
Enter all the data that is on the envelope (for details see table below).
If any of the information is missing, check if it has been forgotten.
Has the leaf been scanned, one thickness measurement is missing, etc.
If anything is missing bring the leaf back to the according station in the trait wheel.
When finished, check the box on the envelope that the data has been entered.
Take a picture of the envelope.
Bring the envelop to the drying station.</p>
<p><em>What to write on the envelope</em></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">What to fill in</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">Three-D</td>
</tr>
<tr class="even">
<td align="left">Collection day</td>
<td align="left">add day, e.g. 24</td>
</tr>
<tr class="odd">
<td align="left">Site</td>
<td align="left">Vik, Joa, Lia</td>
</tr>
<tr class="even">
<td align="left">Elevation</td>
<td align="left">469, 920, 1290</td>
</tr>
<tr class="odd">
<td align="left">Genus</td>
<td align="left">Bistorta</td>
</tr>
<tr class="even">
<td align="left">Species</td>
<td align="left">vivipara</td>
</tr>
<tr class="odd">
<td align="left">Project</td>
<td align="left">Trait = group 1 + 2, Sean = group 3, Drone = group 5</td>
</tr>
<tr class="even">
<td align="left">Experiment</td>
<td align="left">ambient, warm, N level, grazing</td>
</tr>
<tr class="odd">
<td align="left">PlotID</td>
<td align="left">turfID, e.g. 2 W5M 125</td>
</tr>
<tr class="even">
<td align="left">Individual Nr</td>
<td align="left">numeric value</td>
</tr>
</tbody>
</table></div>
<div class="inline-figure"><img src="images/trait_wheel/Dry.png" width="10%"></div>
<p><strong>Dry mass</strong></p>
<p>The leaves will be dried in the oven for 72 hours.</p>
<div class="inline-figure"><img src="images/trait_wheel/Check.png" width="15%"></div>
<p><strong>Data checking</strong></p>
<p>Find the folder with the leave scans on google drive: link
Open each scan and check the follwing criterias:</p>
<ul>
<li>Is the whole leaf on the scan?</li>
<li>Has nothing else been scanned (cable, paper,…)?</li>
<li>Is there dirty the scan?</li>
<li>Has the leaf been cut? If yes, is it indicated on the envelope?</li>
<li>How many leaves are on the scan? If &gt; 1 is there a remark on the envelope?</li>
</ul>
<p>Open RStudio project and the R script (…).
Download the trait data from google sheet.
Check if the leafID is valid.
Check if the variables have valid entries. E.g. correct day, site name, elevations, etc.
Check if missing values can be found on the envelope or retrieved from the data.
Plot the data to check if traits have unrealistic values.</p>
<div class="inline-figure"><img src="images/trait_wheel/DataDoc.png" width="8%"></div>
<p><strong>Data documentation</strong></p>
<p>Describing method
Describing data</p>

</div>
<div id="data-handling-and-analysis" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Data handling and analysis<a class="anchor" aria-label="anchor" href="#data-handling-and-analysis"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="images/resources/icons_all.jpg" width="100%"></div>
<p>Getting started with R, working in R and …</p>
<p><a href="https://biostats-r.github.io/biostats/index.html">Biostats books</a></p>

</div>
<div id="bootstrapping" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> bootstrapping<a class="anchor" aria-label="anchor" href="#bootstrapping"><i class="fas fa-link"></i></a>
</h2>
<!-- fig.align = 'right',  -->
<div class="inline-figure"><img src="images/resources/Traitstrap_hex.png" width="15%" style="float:right; padding:8px"></div>
<p>This vignette explains how to use the traitstrap package (Telford et al).
For more details on the methods see Maitner et al.</p>
<p>First of all, relax and turn on some music. We have prepared the <a href="https://tinyurl.com/traitstrap">traitstrap playlist</a> for you!</p>
<div id="the-aim-of-traitstrap" class="section level3" number="3.4.1">
<h3>
<span class="header-section-number">3.4.1</span> The aim of traitstrap<a class="anchor" aria-label="anchor" href="#the-aim-of-traitstrap"><i class="fas fa-link"></i></a>
</h3>
<p>Trait distributions can be used to infer the importance of community assembly processes and the role of climate drivers in shaping species and community responses to climate change.
Community ecology has typically focused on the <strong>mean</strong>, however the <strong>higher moments</strong> (variance, skewness, and kurtosis) of trait distributions can reveal information about the various processes shaping species diversity.</p>
<div class="inline-figure"><img src="images/resources/true-dist.png" width="90%"></div>
<p>Measuring trait distributions is often difficult and time-consuming as it requires information on measuring trait values of all individuals present.
Sampling protocols often limit sampling to a non-representative subset of the community, or rely upon species-level average traits values calculated in other locations or across many locations.</p>
<p>Traditionally the moments of trait distributions have been estimated using weighting approaches that rely on the average traits of species weighted by some measure of abundance within the community.
Such <strong>community-weighted</strong> trait moments methods assume that a species’ trait expression can be adequately represented by the mean, ignoring intraspecific trait variation.</p>
<p>To more accurately estimate local trait distributions, trait sampling should thus occur both across multiple individuals within each species, and across multiple locations or experimental treatments across the extent of the study in order to capture both inter- and intra-specific variability.</p>
<div class="inline-figure"><img src="images/resources/comm-boot.png" width="90%"></div>
<p><strong>Traitstrap</strong> is an <strong>R package</strong> to estimate the moments of community trait distributions using a <strong>bootstrapping approach</strong>.
Further, this package uses a hierarchical sampling design, which allows accounting for incomplete trait collections, traits from different spatial or temporal levels (e.g. local traits vs. databases), taxonomic hierarchies (e.g., species vs genus) and experimental designs (e.g., multiple sites, or treated vs. control sampling units).</p>
<p>The package has three <strong>main functions</strong>:</p>
<ul>
<li>
<strong>trait imputation</strong> function which allows to account for intraspecific trait variation and hierarchical sampling design.</li>
<li>a resample method using <strong>bootstrapping</strong> (parametric or nonparametric method) to calculate community weighted mean and happy moments (variance, skewness and kurtosis).</li>
<li>a <strong>summary function</strong> that summarizes the trait moments and calculates confidence intervals.</li>
</ul>
<p>Note that for this tutorial we are calling the mean and the higher moments the happy moments :-)</p>
</div>
<div id="the-data" class="section level3" number="3.4.2">
<h3>
<span class="header-section-number">3.4.2</span> The data<a class="anchor" aria-label="anchor" href="#the-data"><i class="fas fa-link"></i></a>
</h3>
<p>For this vignette we will use part of a vascular plant dataset from two sites near Longyearbyen on Svalbard.
The data was collected during the Plant Functional Trait Course in 2018 and contains data on the plant community composition and functional traits.
For more details see this <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_4_Svalbard">GitHub repo</a></p>
<p>Note that some of the species names have been adapted.</p>
</div>
<div id="organize-your-data" class="section level3" number="3.4.3">
<h3>
<span class="header-section-number">3.4.3</span> Organize your data<a class="anchor" aria-label="anchor" href="#organize-your-data"><i class="fas fa-link"></i></a>
</h3>
<p>To run traitstrap two datasets are required:</p>
<ul>
<li>one dataset with information on abundance (e.g. biomass, size, cover, etc.) of the community, which is used to weight species traits by abundance in the community.</li>
<li>one dataset with the traits for each species (or as many species and individuals you have data for) in your community.</li>
</ul>
<p>The datasets need to be organized in a <strong>tidy</strong> and <strong>long</strong> format and certain columns (see below) are required, but the naming of these columns are up to the user.</p>
<p>Let us have a look at these datasets in an example.</p>
<p>The <strong>community data</strong> should have information the abundance of species in the community.
This dataset will be used to weigh the traits by species abundance.
Note that abundance can also be cover, size, biomass, or something similar.</p>
<p>In this example the contains species names (e.g. <strong>Taxon</strong>), cover of each species per plot (e.g. <strong>Cover</strong>) and two columns with information about the <strong>hierarchy</strong> (i.e. <strong>Site</strong> and <strong>PlotID</strong>).</p>
<pre><code>#&gt; # A tibble: 110 × 4
#&gt;    Taxon             Cover Site  PlotID
#&gt;    &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
#&gt;  1 alopecurus ovatus   0.5 1     B     
#&gt;  2 alopecurus ovatus   1   1     C     
#&gt;  3 alopecurus ovatus   1   1     D     
#&gt;  4 alopecurus ovatus   2   1     F     
#&gt;  5 alopecurus ovatus   0.1 1     G     
#&gt;  6 bistorta vigdis    10   1     A     
#&gt;  7 bistorta vigdis    25   1     B     
#&gt;  8 bistorta vigdis    10   1     C     
#&gt;  9 bistorta vigdis     2   1     D     
#&gt; 10 bistorta vigdis     1   1     F     
#&gt; # … with 100 more rows</code></pre>
<p>The <strong>trait data</strong> should contain information about traits and trait values for as many species and individuals in the community data as possible.
The data should be organized in the same way as the community data and should have corresponding columns.
In this example the trait data contains <strong>Taxon</strong>, <strong>Site</strong> and <strong>PlotID</strong> as well as <strong>Trait</strong> and <strong>Value</strong>.</p>
<pre><code>#&gt; # A tibble: 749 × 5
#&gt;    Taxon                   Site  PlotID Trait         Value
#&gt;    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;
#&gt;  1 saxifraga oppositifolia 1     A      Wet_Mass_g 0.000695
#&gt;  2 bistorta vigdis         1     C      Wet_Mass_g 0.0105  
#&gt;  3 festuca rubra           2     C      Wet_Mass_g 0.00724 
#&gt;  4 bistorta vigdis         1     C      Wet_Mass_g 0.0189  
#&gt;  5 equisetum arvense       1     E      Wet_Mass_g 0.270   
#&gt;  6 bistorta vigdis         1     B      Wet_Mass_g 0.0231  
#&gt;  7 luzula confusa          1     F      Wet_Mass_g 0.0135  
#&gt;  8 alopecurus ovatus       1     G      Wet_Mass_g 0.0234  
#&gt;  9 alopecurus ovatus       1     G      Wet_Mass_g 0.0300  
#&gt; 10 alopecurus ovatus       1     C      Wet_Mass_g 0.0267  
#&gt; # … with 739 more rows</code></pre>
</div>
<div id="trait-imputation" class="section level3" number="3.4.4">
<h3>
<span class="header-section-number">3.4.4</span> Trait imputation<a class="anchor" aria-label="anchor" href="#trait-imputation"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>trait_impute</code> function uses a hierarchical sampling design, which allows to account for incomplete trait collections, traits from different spatial or temporal levels (i.e. local traits vs. databases), different taxonomic resolution and/or experimental design.</p>
<p>The first two mandatory arguments in the function are the two datasets:
<code>comm</code> and <code>traits</code></p>
<p>The next four arguments are also mandatory and refer to specific columns in the trait or community dataset:</p>
<ul>
<li>
<code>abundance</code> which is the abundance of your species in your community dataset. This can be abundance, cover, biomass, or size, etc.</li>
<li>
<code>taxon_col</code> is the column in your community and trait data that define the species.</li>
<li>
<code>trait_col</code> is the column in your trait data that defines the traits.</li>
<li>
<code>value_col</code> is the column in your trait data that defines the trait values.</li>
</ul>
<p>All the other arguments are not mandatory.</p>
<p>With <code>scale_hierarchy</code> you can define the levels at which the traits have been collected and the order of trait imputation starting with the highest level (e.g. global database, regional, site, plot).
In the example below we have the levels <strong>Site</strong> and <strong>PlotID</strong>, starting with the highest level.</p>
<p>The <code>trait_impute</code> function will choose if available a trait value from the lowest level, i.e. species X from plot A in site 1.
If no trait value is available from that level (plot A, site 1), it will other groups in the same level and choose a trait value from species X from plot B or C at site 1.
If there is no trait available, it will move up the hierarchy to the next level and choose trait values from species X from other sites (site 2, 3, etc.).</p>
<p>The argument <code>min_n_in_samples</code> allows users to define the minimum number in samples that are chosen at each level.
If the minimum number is not reached (i.e. there are only 3 trait values at a specific level), trait values from the next higher level will be imputed, to avoid sampling the same individual several times, which could result in unrealistic variances.
The default minimum number of samples is 5.</p>
<p>In the <code>other_col</code> argument other grouping variables in the community dataset can be defined and will be kept after the trait imputation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trait_imputation</span> <span class="op">&lt;-</span> <span class="fu">trait_impute</span><span class="op">(</span>
    <span class="co"># input data (mandatory)</span>
    comm <span class="op">=</span> <span class="va">community</span>,
    traits <span class="op">=</span> <span class="va">trait</span>,
    
    <span class="co"># specifies columns in your data (mandatory)</span>
    abundance_col <span class="op">=</span> <span class="st">"Cover"</span>,
    taxon_col <span class="op">=</span> <span class="st">"Taxon"</span>,
    trait_col <span class="op">=</span> <span class="st">"Trait"</span>,
    value_col <span class="op">=</span> <span class="st">"Value"</span>,
    
    <span class="co"># specifies sampling hierarchy</span>
    scale_hierarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site"</span>, <span class="st">"PlotID"</span><span class="op">)</span>,
    
    <span class="co"># min number of samples</span>
    min_n_in_sample <span class="op">=</span> <span class="fl">9</span>
  <span class="op">)</span>
<span class="va">trait_imputation</span>
<span class="co">#&gt; # A tibble: 4,007 × 12</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    Taxon  Cover Site  PlotID global sum_abun Trait   Value n_sample weight level</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;ord&gt;</span>
<span class="co">#&gt;  1 festu…     1 1     A      global     38.2 Wet_… 0.00724       11 0.0909 glob…</span>
<span class="co">#&gt;  2 festu…     1 1     A      global     38.2 Wet_… 0.0160        11 0.0909 glob…</span>
<span class="co">#&gt;  3 festu…     1 1     A      global     38.2 Wet_… 0.00529       11 0.0909 glob…</span>
<span class="co">#&gt;  4 festu…     1 1     A      global     38.2 Wet_… 0.0154        11 0.0909 glob…</span>
<span class="co">#&gt;  5 festu…     1 1     A      global     38.2 Wet_… 0.0066        11 0.0909 glob…</span>
<span class="co">#&gt;  6 festu…     1 1     A      global     38.2 Wet_… 0.00637       11 0.0909 glob…</span>
<span class="co">#&gt;  7 festu…     1 1     A      global     38.2 Wet_… 0.00491       11 0.0909 glob…</span>
<span class="co">#&gt;  8 festu…     1 1     A      global     38.2 Wet_… 0.0132        11 0.0909 glob…</span>
<span class="co">#&gt;  9 festu…     1 1     A      global     38.2 Wet_… 0.0233        11 0.0909 glob…</span>
<span class="co">#&gt; 10 festu…     1 1     A      global     38.2 Wet_… 0.0115        11 0.0909 glob…</span>
<span class="co">#&gt; # … with 3,997 more rows, and 1 more variable: max_n_in_sample &lt;int&gt;</span></code></pre></div>
<p>Traitstrap also allows to include taxonomy and experimental design in the trait imputation step.</p>
<p>With the argument <code>taxon_col</code> the taxonomic hierarchy for sampling can be defined.
This means if traits for a specific species are not available, trait values from the same genus will be imputed.
For this a list of the taxonomic hierarchy has to be defined (e.g. “Taxon”, “Genus”).
Note that traits from species of the same genus can have very different traits and it might not be meaningful to impute these traits.
Therefore, you should always check the trait distributions for the same genus before using taxonomic trait imputation.</p>
<p>The argument <code>treatment_col</code> allows to incorporate an experimental design where traits are imputed from the same experimental treatment or the first factor level, which is assumed to be the control.
Therefore, it is important to order the levels of a treatment in the right order, i.e. the first level has to be the control.
The imputation step can be defined at certain level using the <code>treatment_level</code> argument.
Depending on the experimental design it might make sense to impute traits at a certain level, e.g. block or site.</p>
<p>Here is an example how to include taxonomy and experimental design in the trait imputation function (code not run).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="resources.html#cb4-1" aria-hidden="true" tabindex="-1"></a>trait_imputation2 <span class="ot">&lt;-</span> <span class="fu">trait_impute</span>(</span>
<span id="cb4-2"><a href="resources.html#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">comm =</span> community,</span>
<span id="cb4-3"><a href="resources.html#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> trait,</span>
<span id="cb4-4"><a href="resources.html#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="resources.html#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_col =</span> <span class="st">"Cover"</span>,</span>
<span id="cb4-6"><a href="resources.html#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="resources.html#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># defining taxonomic hierarchy</span></span>
<span id="cb4-8"><a href="resources.html#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon_col =</span> <span class="fu">c</span>(<span class="st">"Taxon"</span>, <span class="st">"Genus"</span>),</span>
<span id="cb4-9"><a href="resources.html#cb4-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-10"><a href="resources.html#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trait_col =</span> <span class="st">"Trait"</span>,</span>
<span id="cb4-11"><a href="resources.html#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_col =</span> <span class="st">"Value"</span>,</span>
<span id="cb4-12"><a href="resources.html#cb4-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-13"><a href="resources.html#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale_hierarchy =</span> <span class="fu">c</span>(<span class="st">"Site"</span>, <span class="st">"PlotID"</span>),</span>
<span id="cb4-14"><a href="resources.html#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_n_in_sample =</span> <span class="dv">3</span></span>
<span id="cb4-15"><a href="resources.html#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="resources.html#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specifying experimental design</span></span>
<span id="cb4-17"><a href="resources.html#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_col =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb4-18"><a href="resources.html#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_level =</span> <span class="st">"Site"</span>,</span>
<span id="cb4-19"><a href="resources.html#cb4-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="nonparametric-bootstrapping" class="section level3" number="3.4.5">
<h3>
<span class="header-section-number">3.4.5</span> Nonparametric bootstrapping<a class="anchor" aria-label="anchor" href="#nonparametric-bootstrapping"><i class="fas fa-link"></i></a>
</h3>
<p>The output of the trait imputation function is then used to do a <strong>nonparametric bootstrapping</strong> using the <code>trait_np_bootstrap</code> function.</p>
<p>Nonparametric bootstrapping is a resampling method to estimate the trait moments.
The traits are re-sampled in proportion to their weight in the community (e.g. by the abundance of the species).</p>
<p>The trait values across all individuals in a community are resampled n times (<code>sample_size</code>; the default is 200) to incorporate the full spectrum of trait variation, generating n number (<code>nrep</code>; the default is 100) of trait distributions.</p>
<p>From these trait distributions the happy moments are estimated: <strong>mean</strong>, <strong>variance</strong>, <strong>skewness</strong> and <strong>kurtosis</strong>.</p>
<p>This function also allows to extract raw distributions by setting the argument <code>raw = TRUE</code>.
The raw data can be useful for visualizing the trait distributions.
If the raw data is extracted, <code>nrep</code> is forced to 1 to avoid memory issues.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run nonparametric bootstrapping</span>
<span class="va">np_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu">trait_np_bootstrap</span><span class="op">(</span>
  <span class="va">trait_imputation</span>, 
  nrep <span class="op">=</span> <span class="fl">200</span>
  <span class="op">)</span>
<span class="va">np_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 × 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.59    1.86         2.63     9.21 </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0121  0.0000593    0.758    0.852</span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.72    2.56         2.86     9.35 </span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0135  0.0000808    1.33     2.03 </span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.82    1.82         2.34     5.92 </span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0158  0.000254     5.73    43.0  </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 1.88    4.70         2.48     5.83 </span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0116  0.0000357    1.06     1.55 </span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 6.96   16.1          0.166   -0.608</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0183  0.000398     2.19     3.44 </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code></pre></div>
<p>One advantage of using a bootstrapping approach, is that we get much more than a mean trait value.
We can also estimate the variance and other moments of these trait distributions.
In traitstrap happy moments can be summarized and the confidence intervals calculated using the <code>trait_summarise_boot_moments</code> function.
The input variable for this function is the output from the nonparametric bootstrapping function (or the parametric bootstrapping function, see below).</p>
<p>The confidence interval can be calculated parametrically, using the mean and standard deviation, or nonparametrically using quantiles.
The default is using the mean and standard deviation (<code>parametric = TRUE</code>) with one standard deviation around each trait moment (<code>sd_mult = 1</code>).
For the nonparametric approach the default is a 0.95 confidence level.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarizes bootstrapping output</span>
<span class="va">sum_boot_moment</span> <span class="op">&lt;-</span> <span class="fu">trait_summarise_boot_moments</span><span class="op">(</span>
  <span class="va">np_bootstrapped_moments</span>
  <span class="op">)</span>
<span class="va">sum_boot_moment</span>
<span class="co">#&gt; # A tibble: 28 × 17</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    global Site  PlotID Trait           n   mean ci_low_mean ci_high_mean     var</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plant_Heig…   200 1.72        1.60         1.83   2.67e+0</span>
<span class="co">#&gt;  2 global 1     A      Wet_Mass_g    200 0.0121      0.0115       0.0127 6.52e-5</span>
<span class="co">#&gt;  3 global 1     B      Plant_Heig…   200 1.75        1.64         1.87   2.62e+0</span>
<span class="co">#&gt;  4 global 1     B      Wet_Mass_g    200 0.0136      0.0130       0.0142 6.89e-5</span>
<span class="co">#&gt;  5 global 1     C      Plant_Heig…   200 1.72        1.62         1.81   1.81e+0</span>
<span class="co">#&gt;  6 global 1     C      Wet_Mass_g    200 0.0150      0.0142       0.0157 1.36e-4</span>
<span class="co">#&gt;  7 global 1     D      Plant_Heig…   200 1.86        1.73         2.00   4.65e+0</span>
<span class="co">#&gt;  8 global 1     D      Wet_Mass_g    200 0.0118      0.0113       0.0123 5.12e-5</span>
<span class="co">#&gt;  9 global 1     E      Plant_Heig…   200 7.08        6.79         7.38   1.69e+1</span>
<span class="co">#&gt; 10 global 1     E      Wet_Mass_g    200 0.0162      0.0150       0.0174 2.75e-4</span>
<span class="co">#&gt; # … with 18 more rows, and 8 more variables: ci_low_var &lt;dbl&gt;,</span>
<span class="co">#&gt; #   ci_high_var &lt;dbl&gt;, skew &lt;dbl&gt;, ci_low_skew &lt;dbl&gt;, ci_high_skew &lt;dbl&gt;,</span>
<span class="co">#&gt; #   kurt &lt;dbl&gt;, ci_low_kurt &lt;dbl&gt;, ci_high_kurt &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="parametric-bootstrapping" class="section level3" number="3.4.6">
<h3>
<span class="header-section-number">3.4.6</span> Parametric bootstrapping<a class="anchor" aria-label="anchor" href="#parametric-bootstrapping"><i class="fas fa-link"></i></a>
</h3>
<p>Traitstrap also offers the option to run a <strong>parametric bootstrapping</strong>.</p>
<p>The <code>trait_fit_distributions</code> function fits parametric distributions for each species-by-trait combination at the finest scale of the user-supplied hierarchy.
This function takes as input:</p>
<ul>
<li>an object of class imputed traits (as produced by the function <code>trait_impute</code>), and</li>
<li>the type of distribution to be fitted.</li>
</ul>
<p>Either a single distribution type can be used for all traits, or traits can be assigned specific distributions types by supplying the function with a named list of traits (e.g. <code>list(height = "normal", mass = "lognormal")</code>).</p>
<p>Currently the function supports normal, log-normal, and beta (values between 0 and 1) distributions.</p>
<p>The function returns a dataframe containing fitted distribution parameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu">trait_fit_distributions</span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="st">"lognormal"</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning in .data[["Trait"]] == names(distribution_type)[distribution_type == :</span>
<span class="co">#&gt; longer object length is not a multiple of shorter object length</span>
<span class="va">fitted_distributions</span>
<span class="co">#&gt; # A tibble: 202 × 15</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait, Taxon, Cover, n_sample [202]</span>
<span class="co">#&gt;    global Site  PlotID Trait  Taxon Cover n_sample distribution_ty…  parm1 parm2</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plant… bist…  10         28 lognormal         0.328 0.517</span>
<span class="co">#&gt;  2 global 1     A      Plant… drya…   0.1        9 lognormal         1.04  0.704</span>
<span class="co">#&gt;  3 global 1     A      Plant… fest…   1         11 lognormal         1.61  0.377</span>
<span class="co">#&gt;  4 global 1     A      Plant… luzu…   0.5       15 lognormal         1.50  0.325</span>
<span class="co">#&gt;  5 global 1     A      Plant… luzu…   1         20 lognormal         0.588 0.459</span>
<span class="co">#&gt;  6 global 1     A      Plant… sali…  20         44 lognormal        -0.138 0.931</span>
<span class="co">#&gt;  7 global 1     A      Plant… saxi…   2          6 lognormal         1.13  0.469</span>
<span class="co">#&gt;  8 global 1     A      Plant… saxi…   2          2 lognormal         0.693 0    </span>
<span class="co">#&gt;  9 global 1     A      Plant… sile…   1          3 lognormal        -0.221 0.277</span>
<span class="co">#&gt; 10 global 1     A      Wet_M… bist…  10         29 lognormal        -4.06  0.454</span>
<span class="co">#&gt; # … with 192 more rows, and 5 more variables: sd1 &lt;lgl&gt;, sd2 &lt;lgl&gt;, ks &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cvm &lt;dbl&gt;, ad &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit several types of distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu">trait_fit_distributions</span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Plant_Height_cm <span class="op">=</span> <span class="st">"normal"</span>, Wet_Mass_g <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">fitted_distributions</span></code></pre></div>
<p>The <code>trait_parametric_bootstrap</code> function is a parametric analogue of the <code>trait_np_bootstrap</code> function.
It takes in fitted trait distributions produced by <code>trait_fit_distributions</code> and randomly samples from among the fitted distributions proportionally to species abundances in the community.</p>
<p>As with <code>trait_np_bootstrap</code>, the number of samples per replicated draw are specified with the parameter <code>sample_size</code>, and the number of replicated draws is specified by the parameter <code>nrep.</code>
The argument <code>raw</code> allows to extract raw distributions (see above).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run parametric bootstrapping</span>
<span class="va">p_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu">trait_parametric_bootstrap</span><span class="op">(</span>
    fitted_distributions <span class="op">=</span> <span class="va">fitted_distributions</span>, 
    nrep <span class="op">=</span> <span class="fl">200</span>
    <span class="op">)</span>
<span class="va">p_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 × 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.73    2.39         2.47     10.4 </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0116  0.0000683    1.31      2.26</span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.85    2.79         1.69      2.82</span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0137  0.0000766    1.46      2.51</span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.81    1.67         2.01      3.95</span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0153  0.000257     7.15     68.4 </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 1.98    4.70         1.76      2.70</span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0116  0.0000411    2.04      5.46</span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 7.30   19.8          0.939     1.83</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0167  0.000298     3.62     18.8 </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code></pre></div>
<p>The output of trait_parametric_bootstrap can be summarized using <code>trait_summarize_boot_moments</code> (see above).</p>
</div>
<div id="extracting-raw-distributions" class="section level3" number="3.4.7">
<h3>
<span class="header-section-number">3.4.7</span> Extracting raw distributions<a class="anchor" aria-label="anchor" href="#extracting-raw-distributions"><i class="fas fa-link"></i></a>
</h3>
<p>In traitstrap both the parametric and nonparametric bootstrapping functions allow returning raw trait distributions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run nonparametric bootstrapping</span>
<span class="va">raw_dist_np</span> <span class="op">&lt;-</span> <span class="fu">trait_np_bootstrap</span><span class="op">(</span>
  <span class="va">trait_imputation</span>,
  raw <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="va">raw_dist_np</span>
<span class="co">#&gt; # A tibble: 5,600 × 13</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     Taxon    Cover Site  PlotID global sum_abun Trait Value n_sample weight</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     salix p…    20 1     A      global     38.2 Plan…   6.1       44  0.455</span>
<span class="co">#&gt;  2 1     salix p…    20 1     A      global     38.2 Plan…   0.4       44  0.455</span>
<span class="co">#&gt;  3 1     salix p…    20 1     A      global     38.2 Plan…   1.3       44  0.455</span>
<span class="co">#&gt;  4 1     salix p…    20 1     A      global     38.2 Plan…   0.4       44  0.455</span>
<span class="co">#&gt;  5 1     salix p…    20 1     A      global     38.2 Plan…   0.3       44  0.455</span>
<span class="co">#&gt;  6 1     salix p…    20 1     A      global     38.2 Plan…   0.3       44  0.455</span>
<span class="co">#&gt;  7 1     salix p…    20 1     A      global     38.2 Plan…   0.7       44  0.455</span>
<span class="co">#&gt;  8 1     salix p…    20 1     A      global     38.2 Plan…   0.3       44  0.455</span>
<span class="co">#&gt;  9 1     salix p…    20 1     A      global     38.2 Plan…   1.5       44  0.455</span>
<span class="co">#&gt; 10 1     salix p…    20 1     A      global     38.2 Plan…   1         44  0.455</span>
<span class="co">#&gt; # … with 5,590 more rows, and 2 more variables: level &lt;ord&gt;,</span>
<span class="co">#&gt; #   max_n_in_sample &lt;int&gt;</span></code></pre></div>
<p>The raw data can be useful for visualizing the trait distributions.</p>
<p>Use colour and facets to separate between the different traits, hierarchies and treatments.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">raw_dist_np</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">Site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>end <span class="op">=</span> <span class="fl">0.9</span>, option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log(trait value)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="3-4_bootstrapping_files/figure-html/plot-raw-dist-np-1.png" width="576"></div>
</div>
<div id="check-your-data" class="section level3" number="3.4.8">
<h3>
<span class="header-section-number">3.4.8</span> Check your data<a class="anchor" aria-label="anchor" href="#check-your-data"><i class="fas fa-link"></i></a>
</h3>
<p>Traitstrap has a couple of functions to check the data.</p>
<p>The <code>coverage_plot</code> function shows the trait coverage of the community for each level.
Basically, this function summarizes from which level the traits are imputed, and how much coverage of the community is reached.</p>
<p>Based on simulations, we recommend to collect traits for at least 80% of the community cover (Maitner et al. in prep).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># show coverage plot</span>
<span class="fu">autoplot</span><span class="op">(</span><span class="va">trait_imputation</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="3-4_bootstrapping_files/figure-html/coverage-plot-1.png" width="576"></div>
<p>Another important information is to know of which taxa traits are missing.
This can be useful if the data sampling is not finished and you want to know which species should be sampled.
The function also tells you the maximal abundance of each missing species, and gives you useful information if the missing species are abundant or rare.</p>
<p>Traitstrap has a function <code>trait_missing</code> which gives you a table with all missing values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># list missing traits</span>
<span class="fu">trait_missing</span><span class="op">(</span>imputed_trait <span class="op">=</span> <span class="va">trait_imputation</span>,
              comm <span class="op">=</span> <span class="va">community</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 × 3</span>
<span class="co">#&gt; # Groups:   Taxon [20]</span>
<span class="co">#&gt;    Taxon                      max_abun n_traits</span>
<span class="co">#&gt;    &lt;chr&gt;                         &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1 alopecurus ovatus               2          2</span>
<span class="co">#&gt;  2 bistorta vigdis                25          2</span>
<span class="co">#&gt;  3 calamagrostis neglecta         60          2</span>
<span class="co">#&gt;  4 cassiope tetragona              5          2</span>
<span class="co">#&gt;  5 dryas octopetala               20          2</span>
<span class="co">#&gt;  6 enquistetum scirpoides          2          2</span>
<span class="co">#&gt;  7 festuca rubra                   1          2</span>
<span class="co">#&gt;  8 juncus biglumis                 0.5        1</span>
<span class="co">#&gt;  9 luzula confusa                  5          2</span>
<span class="co">#&gt; 10 luzula nivalis                  5          2</span>
<span class="co">#&gt; 11 maitneranthes hieracifolia      0.5        1</span>
<span class="co">#&gt; 12 oxyria tanyna                   2          2</span>
<span class="co">#&gt; 13 poa pratensis                   1          2</span>
<span class="co">#&gt; 14 salix polaris                  43          2</span>
<span class="co">#&gt; 15 saxifraga hirculus              2          2</span>
<span class="co">#&gt; 16 saxifraga oppositifolia         2          2</span>
<span class="co">#&gt; 17 silene acaudis                  1          2</span>
<span class="co">#&gt; 18 stelfordaria humifusa           0.5        1</span>
<span class="co">#&gt; 19 stellaria longipes              0.1        1</span>
<span class="co">#&gt; 20 trisetum spicatum               3          2</span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="pftc-6-course-information.html"><span class="header-section-number">2</span> PFTC 6 Course information</a></div>
<div class="next"><a href="group-projects.html"><span class="header-section-number">4</span> Group projects</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#resources"><span class="header-section-number">3</span> Resources</a></li>
<li>
<a class="nav-link" href="#field-based-data-collection"><span class="header-section-number">3.1</span> Field based data collection</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#what-to-think-about-before-going-to-the-field"><span class="header-section-number">3.1.1</span> What to think about before going to the field</a></li></ul>
</li>
<li><a class="nav-link" href="#how-to-measure-plant-functional-traits"><span class="header-section-number">3.2</span> How to measure plant functional traits?</a></li>
<li><a class="nav-link" href="#data-handling-and-analysis"><span class="header-section-number">3.3</span> Data handling and analysis</a></li>
<li>
<a class="nav-link" href="#bootstrapping"><span class="header-section-number">3.4</span> bootstrapping</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-aim-of-traitstrap"><span class="header-section-number">3.4.1</span> The aim of traitstrap</a></li>
<li><a class="nav-link" href="#the-data"><span class="header-section-number">3.4.2</span> The data</a></li>
<li><a class="nav-link" href="#organize-your-data"><span class="header-section-number">3.4.3</span> Organize your data</a></li>
<li><a class="nav-link" href="#trait-imputation"><span class="header-section-number">3.4.4</span> Trait imputation</a></li>
<li><a class="nav-link" href="#nonparametric-bootstrapping"><span class="header-section-number">3.4.5</span> Nonparametric bootstrapping</a></li>
<li><a class="nav-link" href="#parametric-bootstrapping"><span class="header-section-number">3.4.6</span> Parametric bootstrapping</a></li>
<li><a class="nav-link" href="#extracting-raw-distributions"><span class="header-section-number">3.4.7</span> Extracting raw distributions</a></li>
<li><a class="nav-link" href="#check-your-data"><span class="header-section-number">3.4.8</span> Check your data</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>PFTC Teaching Material</strong>" was written by Aud Halbritter. It was last built on 2022-03-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Data curation and analysis | PFTC Teaching Material</title>
<meta name="author" content="Aud Halbritter">
<meta name="description" content="5.1 Introduction to R/RStudio, data analysis and more The Biostats books are an extensive resource for getting started with R and RStudio, working in R, coding, using Rmarkdown, git and GitHub and...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="5 Data curation and analysis | PFTC Teaching Material">
<meta property="og:type" content="book">
<meta property="og:description" content="5.1 Introduction to R/RStudio, data analysis and more The Biostats books are an extensive resource for getting started with R and RStudio, working in R, coding, using Rmarkdown, git and GitHub and...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Data curation and analysis | PFTC Teaching Material">
<meta name="twitter:description" content="5.1 Introduction to R/RStudio, data analysis and more The Biostats books are an extensive resource for getting started with R and RStudio, working in R, coding, using Rmarkdown, git and GitHub and...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.12/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style-chapters.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">PFTC Teaching Material</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">PFTC Teaching material</a></li>
<li><a class="" href="pftc-6-course-information.html"><span class="header-section-number">1</span> PFTC 6 Course information</a></li>
<li><a class="" href="the-pftc6-study-system.html"><span class="header-section-number">2</span> The PFTC6 study system</a></li>
<li><a class="" href="trait-data-collection-and-measurements.html"><span class="header-section-number">3</span> Trait data collection and measurements</a></li>
<li><a class="" href="working-with-pftc-data.html"><span class="header-section-number">4</span> Working with PFTC data</a></li>
<li><a class="active" href="data-curation-and-analysis.html"><span class="header-section-number">5</span> Data curation and analysis</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-curation-and-analysis" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Data curation and analysis<a class="anchor" aria-label="anchor" href="#data-curation-and-analysis"><i class="fas fa-link"></i></a>
</h1>

<div id="introduction-to-rrstudio-data-analysis-and-more" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Introduction to R/RStudio, data analysis and more<a class="anchor" aria-label="anchor" href="#introduction-to-rrstudio-data-analysis-and-more"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://biostats-r.github.io/biostats/index.html">Biostats books</a> are an extensive resource for getting started with R and RStudio, working in R, coding, using Rmarkdown, git and GitHub and creating an R package.</p>
<div class="inline-figure"><img src="images/resources/icons_all.jpg" width="100%"></div>

</div>
<div id="data-curation" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Data curation<a class="anchor" aria-label="anchor" href="#data-curation"><i class="fas fa-link"></i></a>
</h2>
<p>Data curation, transformation or cleaning is the first step after digitizing the data.
Each dataset has to be checked for errors and corrected as best as possible.
This tutorial shows how to check your dataset for errors and how to correct them.</p>
<p>For this tutorial we will be working with the trait dataset from Svalbard.
See section <a href="working-with-pftc-data.html#working-with-pftc-data">4</a> for how to access the data and information about the study, experiment and datasets.</p>
<div id="useful-packages" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Useful packages<a class="anchor" aria-label="anchor" href="#useful-packages"><i class="fas fa-link"></i></a>
</h3>
<p>There are a couple of R packages that are useful for this work.
First, <strong>tidyverse</strong> is a collection of R packages used for basic data manipulation and analysis.</p>
<p>If you have never used the packages you need to install it first using the function <code>install.packages("tidyverse")</code>.
Otherwise, you can just load the packages.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<p>Second, another useful package for data curation is <strong>tidylog</strong>, which is built on the <strong>dplyr</strong> and <strong>tidyr</strong> packages and provides useful information about the functions used.</p>
<p>Tidylog will for example tell you how many rows have been removed and are remaining when using the <code><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter()</a></code> function or how many rows match when using a join function.
The information is always indicated in absolute numbers and percentage.
The additional information is very useful to check if the right observations have been removed or manipulated, because mistakes are easily done.</p>
<p>Let’s install and/or load <strong>tidylog</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/elbersb/tidylog/">tidylog</a></span><span class="op">)</span></code></pre></div>
<p>Note, that once <strong>tidylog</strong> is loaded it will automatically prioritize the tidylog function before the dplyr and tidyr functions.
You actively have to choose if you do not want to use the tidylog version by using this notation: <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code>.</p>
</div>
<div id="import-data" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Import data<a class="anchor" aria-label="anchor" href="#import-data"><i class="fas fa-link"></i></a>
</h3>
<p>The first step is to import the data to R.
The data is stored as a <em>csv file</em> and we can use the function <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> to import that data.
If your data has another format or importing data is new to, you have a look at this <a href="https://biostats-r.github.io/biostats/workingInR/importing-data-in-r.html">page</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/PFTC4_Svalbard_2018_Gradient_Traits.csv"</span><span class="op">)</span>
<span class="co">#&gt; Rows: 11345 Columns: 15</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr  (7): Project, Gradient, PlotID, ID, Functional_group, Taxon, Trait</span>
<span class="co">#&gt; dbl  (7): Year, Site, Individual_nr, Value, Elevation_m, Latitude_N, Longitu...</span>
<span class="co">#&gt; date (1): Date</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></code></pre></div>
<p>Give the dataset a name that indicates that this is the raw data.</p>
<p>The dataset contains measurements of 14 traits from two elevational gradients on Svalbard.
The traits were measured on individual plants from 21 different graminoid and forb species.
For more information about the sites, traits and measurements see <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_4_Svalbard">here</a>.</p>
<p><strong>Some manipulation</strong></p>
<p>Let us introduce some errors to the dataset.</p>
<p>The code to do this is hidden.
But if you want to replicate the code to introduce errors you can find the code here (add link!!!).</p>
</div>
<div id="first-check-of-the-dataset" class="section level3" number="5.2.3">
<h3>
<span class="header-section-number">5.2.3</span> First check of the dataset<a class="anchor" aria-label="anchor" href="#first-check-of-the-dataset"><i class="fas fa-link"></i></a>
</h3>
<p>By typing <code>raw_traits</code> in the console it will display the first rows and columns of the dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span>
<span class="co">#&gt; # A tibble: 11,346 × 12</span>
<span class="co">#&gt;    Date       Gradient  Site PlotID Individual_nr ID      Taxon    Trait   Value</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-07-20 B            5 D                  1 AIB1395 saxifra… Plan… 6.5 e+0</span>
<span class="co">#&gt;  2 2018-07-20 B            5 D                  1 AIB1395 saxifra… Wet_… 2.92e-2</span>
<span class="co">#&gt;  3 2018-07-20 B            5 D                  1 AIB1395 saxifra… Dry_… 4   e-3</span>
<span class="co">#&gt;  4 2018-07-20 B            5 D                  1 AIB1395 saxifra… Leaf… 5.66e-1</span>
<span class="co">#&gt;  5 2018-07-20 B            5 D                  1 AIB1395 saxifra… Leaf… 6.75e-1</span>
<span class="co">#&gt;  6 2018-07-20 B            5 D                  1 AIB1395 saxifra… SLA_… 1.69e+2</span>
<span class="co">#&gt;  7 2018-07-20 B            5 D                  1 AIB1395 saxifra… LDMC  1.37e-1</span>
<span class="co">#&gt;  8 2018-07-20 B            5 D                  1 AIB1395 saxifra… C_pe… 3.89e+1</span>
<span class="co">#&gt;  9 2018-07-20 B            5 D                  1 AIB1395 saxifra… N_pe… 1.14e+0</span>
<span class="co">#&gt; 10 2018-07-20 B            5 D                  1 AIB1395 saxifra… CN_r… 3.41e+1</span>
<span class="co">#&gt; # … with 11,336 more rows, and 3 more variables: Elevation_m &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Latitude_N &lt;dbl&gt;, Longitude_E &lt;dbl&gt;</span></code></pre></div>
<p>At the top you can see that the dataset has 11346 observations and 12 columns.
These numbers give you a first impression if you have imported the right file, and if all your observations and columns are there.</p>
</div>
<div id="check-the-data-type" class="section level3" number="5.2.4">
<h3>
<span class="header-section-number">5.2.4</span> Check the data type<a class="anchor" aria-label="anchor" href="#check-the-data-type"><i class="fas fa-link"></i></a>
</h3>
<p>The next thing to check is if the variables have the right data type (or class in R terminology).
For each variable the output indicates the data type. The most common types are <em>dbl</em> (numeric or integer), <em>chr</em> (character), or <em>date</em> (date).</p>
<p>If you want to know more about data types see <a href="https://biostats-r.github.io/biostats/workingInR/first-steps-in-r.html#data-types-and-objects">here</a>.</p>
<p>Now we want to check if the variables have the right data type.
The first variable <em>Date</em> is a character, which is not correct.
This probably means that one or several observations have a wrong date.
Let us check all different values for the variable <em>Date</em>.
For this we can use the function <code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code> on the variable <em>Date</em>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>
<span class="co">#&gt; distinct: removed 11,338 rows (&gt;99%), 8 rows remaining</span>
<span class="co">#&gt; # A tibble: 8 × 1</span>
<span class="co">#&gt;   Date      </span>
<span class="co">#&gt;   &lt;chr&gt;     </span>
<span class="co">#&gt; 1 2018-07-20</span>
<span class="co">#&gt; 2 2018-07-18</span>
<span class="co">#&gt; 3 2018-07-21</span>
<span class="co">#&gt; 4 2018-07-24</span>
<span class="co">#&gt; 5 2018-07-19</span>
<span class="co">#&gt; 6 2018-07-17</span>
<span class="co">#&gt; 7 18        </span>
<span class="co">#&gt; 8 &lt;NA&gt;</span></code></pre></div>
<p>We can see that there are 6 distinct dates in this variable.
One of the dates is “18”, which is not a correct date format and turned the variable into a character.
Note that the additional information from the tidylog package about the <code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code> function.
It shows the number of rows removed and remaining.</p>
<p>The next step is to check where the problem occurred.
For this we can use the function <code><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter()</a></code> to extract all observations with the date 18.
We can use <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> to display the whole table.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">==</span> <span class="st">"18"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; filter: removed 11,339 rows (&gt;99%), 7 rows remaining
#&gt; # A tibble: 7 × 12
#&gt;   Date  Gradient  Site PlotID Individual_nr ID      Taxon         Trait    Value
#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt;
#&gt; 1 18    C            1 A                  3 AMO3822 salix polaris Plant… 1.1 e+0
#&gt; 2 18    C            1 A                  3 AMO3822 salix polaris Wet_M… 5.76e-3
#&gt; 3 18    C            1 A                  3 AMO3822 salix polaris Dry_M… 2   e-3
#&gt; 4 18    C            1 A                  3 AMO3822 salix polaris Leaf_… 1.88e-1
#&gt; 5 18    C            1 A                  3 AMO3822 salix polaris Leaf_… 2.84e-1
#&gt; 6 18    C            1 A                  3 AMO3822 salix polaris SLA_c… 1.42e+2
#&gt; 7 18    C            1 A                  3 AMO3822 salix polaris LDMC   3.47e-1
#&gt; # … with 3 more variables: Elevation_m &lt;dbl&gt;, Latitude_N &lt;dbl&gt;,
#&gt; #   Longitude_E &lt;dbl&gt;</code></pre>
<p>We see that it is a single observation (with multiple traits) that has the wrong date.
The next step is to check the raw data, notes, photos, etc. to find the correct date for this observations.
It is important to keep the data entry sheets, take a photo of them and keep the field notes to be able to fix such problems.</p>
<!-- Add picture of the envelope!!! -->
<p>Since the value for date is 18, we will assume now that this was a typo and that the correct date is 2018-07-18.
Let’s replace this value and give the variable the right class.</p>
<p>For this we will use the function <code><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate()</a></code> which adds or manipulates a column.
Inside the mutate we will use the <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> function to replace the date for a specific ID.
We are using the function with a single statement, however this is a powerful function that allow for multiple statements (many if else conditions).
To give the variable the correct class, we use the <code>ymd()</code> function from the lubridate package.
Note that we now have to assign the table to a new or the same name to make the change permanent.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="st">"AMO3822"</span> <span class="op">~</span> <span class="st">"2018-07-18"</span>,
                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Date</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span> Date <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; mutate: changed 7 values (&lt;1%) of 'Date' (0 new NA)</span>
<span class="co">#&gt; mutate: converted 'Date' from character to Date (0 new NA)</span></code></pre></div>
<p>An important step when cleaning data is to check that you have done the right thing.
The <strong>tidylog</strong> functions show that for 7 observation Date has been changed.
This matches with the number of observations that had a wrong date.</p>
<p>To be sure we can look at the specific leaf (ID == “AMO3822”) and see if the date is now corrected.
Another way would be to run the <code>distinct(Date)</code> function again.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="st">"AMO3822"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>
<span class="co">#&gt; filter: removed 11,339 rows (&gt;99%), 7 rows remaining</span>
<span class="co">#&gt; select: dropped 11 variables (Gradient, Site, PlotID, Individual_nr, ID, …)</span>
<span class="co">#&gt; # A tibble: 7 × 1</span>
<span class="co">#&gt;   Date      </span>
<span class="co">#&gt;   &lt;date&gt;    </span>
<span class="co">#&gt; 1 2018-07-18</span>
<span class="co">#&gt; 2 2018-07-18</span>
<span class="co">#&gt; 3 2018-07-18</span>
<span class="co">#&gt; 4 2018-07-18</span>
<span class="co">#&gt; 5 2018-07-18</span>
<span class="co">#&gt; 6 2018-07-18</span>
<span class="co">#&gt; 7 2018-07-18</span></code></pre></div>
<p>The date has been fixed.</p>
</div>
<div id="exercise-1" class="section level3 unnumbered exercise toc-ignore">
<h3>Exercise<a class="anchor" aria-label="anchor" href="#exercise-1"><i class="fas fa-link"></i></a>
</h3>
<p>Now it is your turn.
Check if the data type for the variable <em>Date</em> is now correct.</p>
<details><summary>
Hint
</summary><ul>
<li>type <code>raw_traits</code> to look at the whole dataset where the datatype of each variable is indicated</li>
<li>use <code>class(raw_traits$Date)</code> which will tell you directly what type of class the variable has</li>
<li>use <code>map(raw_traits, class)</code> to get the class of all variable in the dataframe</li>
</ul></details>
</div>
<div id="check-for-duplicates" class="section level3" number="5.2.5">
<h3>
<span class="header-section-number">5.2.5</span> Check for duplicates<a class="anchor" aria-label="anchor" href="#check-for-duplicates"><i class="fas fa-link"></i></a>
</h3>
<p>Another common problem is duplicate observations.
This can happen when data is entered twice.
The why to find duplicates is to check that the combination of variables are unique.
In our dataset, we expect that <em>Date</em>, <em>Gradient</em>, <em>Site</em>, <em>PlotID</em>, <em>Individual_nr</em>, <em>ID</em>, <em>Taxon</em> and <em>Trait</em> should be unique, and only occurring once.</p>
<p>To check this, we can <code><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by()</a></code> these variables and <code><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter()</a></code> for observations that occur more than once.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Gradient</span>, <span class="va">Site</span>, <span class="va">PlotID</span>, <span class="va">Individual_nr</span>, <span class="va">ID</span>, <span class="va">Taxon</span>, <span class="va">Trait</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; group_by: 8 grouping variables (Date, Gradient, Site, PlotID, Individual_nr, …)</span>
<span class="co">#&gt; filter (grouped): removed 11,344 rows (&gt;99%), 2 rows remaining</span>
<span class="co">#&gt; # A tibble: 2 × 12</span>
<span class="co">#&gt; # Groups:   Date, Gradient, Site, PlotID, Individual_nr, ID, Taxon, Trait [1]</span>
<span class="co">#&gt;   Date       Gradient  Site PlotID Individual_nr ID      Taxon     Trait   Value</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2018-07-20 B            3 C                  3 BEK3638 salix po… Dry_… 0.00275</span>
<span class="co">#&gt; 2 2018-07-20 B            3 C                  3 BEK3638 salix po… Dry_… 0.00275</span>
<span class="co">#&gt; # … with 3 more variables: Elevation_m &lt;dbl&gt;, Latitude_N &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Longitude_E &lt;dbl&gt;</span></code></pre></div>
<p>There is one duplicate entry.</p>
<p>Note that <em>Value</em> was not included in the <code><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by()</a></code>.
This was done intentionally, because a common mistake is to have a duplicate, but with a different value.
This is either because one of the variables is wrong, e.g. it has the wrong Site and therefore appears to be a duplicate.
Alternatively, the leaf could have been measured twice by accident, which would likely give two slightly different values.
When getting a duplicate, these different options for why there is a duplicate have to be considered and carefully checked in the raw data.</p>
<p>In this case, we will assume that the leaf has only been measured once, but the data has been entered twice.
Thus, the two entries are exact duplicates.</p>
<p>To fix the duplicate problem, we group by the variables we expect to be unique.
Then we use <code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code> with the argument <em>.keep_all = TRUE</em> to remove the duplicates.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits2</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Gradient</span>, <span class="va">Site</span>, <span class="va">PlotID</span>, <span class="va">Individual_nr</span>, <span class="va">ID</span>, <span class="va">Taxon</span>, <span class="va">Trait</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span>.keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; group_by: 8 grouping variables (Date, Gradient, Site, PlotID, Individual_nr, …)</span>
<span class="co">#&gt; distinct (grouped): removed one row (&lt;1%), 11,345 rows remaining</span></code></pre></div>
<p>Tidylog allows us to see what happens and how many rows have been removed.
There are 8 grouping variables and as expected, one row is filtered away, which is the duplicated row.</p>
<p>We can also run the code from above again to check if the duplicate is gone.</p>
</div>
<div id="check-for-missing-data" class="section level3" number="5.2.6">
<h3>
<span class="header-section-number">5.2.6</span> Check for missing data<a class="anchor" aria-label="anchor" href="#check-for-missing-data"><i class="fas fa-link"></i></a>
</h3>
<p>A common problem in a dataset are missing values.</p>
<p>How to detect missing values…</p>
<p>Once the missing values are detected one has to decide if the missing data can be recovered, or if the missing values should be removed from the dataset.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>
<span class="co">#&gt; drop_na: removed 3 rows (&lt;1%), 11,343 rows remaining</span></code></pre></div>
<p>This operation has removed 3 rows, which is the number of NA’s in the dataset.</p>
</div>
<div id="check-values-within-variables" class="section level3" number="5.2.7">
<h3>
<span class="header-section-number">5.2.7</span> Check values within variables<a class="anchor" aria-label="anchor" href="#check-values-within-variables"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Taxon</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Taxon</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>
<span class="co">#&gt; distinct: removed 11,299 rows (&gt;99%), 44 rows remaining</span>
<span class="co">#&gt; # A tibble: 44 × 1</span>
<span class="co">#&gt;    Taxon                   </span>
<span class="co">#&gt;    &lt;chr&gt;                   </span>
<span class="co">#&gt;  1 alopecurus ovatus       </span>
<span class="co">#&gt;  2 aulacomnium turgidum    </span>
<span class="co">#&gt;  3 bistorta vivipara       </span>
<span class="co">#&gt;  4 calamagrostis neglecta  </span>
<span class="co">#&gt;  5 cassiope tetragona      </span>
<span class="co">#&gt;  6 cerastium arcticum      </span>
<span class="co">#&gt;  7 dicranum sp             </span>
<span class="co">#&gt;  8 draba arctica           </span>
<span class="co">#&gt;  9 draba oxycarpa          </span>
<span class="co">#&gt; 10 dryas octopetala        </span>
<span class="co">#&gt; 11 equisetum arvense       </span>
<span class="co">#&gt; 12 equisetum scirpoides    </span>
<span class="co">#&gt; 13 festuca rubra           </span>
<span class="co">#&gt; 14 festuca viviparoidea    </span>
<span class="co">#&gt; 15 hylocomium splendens    </span>
<span class="co">#&gt; 16 luzula confusa          </span>
<span class="co">#&gt; 17 luzula nivalis          </span>
<span class="co">#&gt; 18 micranthes hieraciifolia</span>
<span class="co">#&gt; 19 micranthes nivalis      </span>
<span class="co">#&gt; 20 niphotrichum canescens  </span>
<span class="co">#&gt; 21 niphotrichum sp         </span>
<span class="co">#&gt; 22 oxiria digyna           </span>
<span class="co">#&gt; 23 oxyra digyna            </span>
<span class="co">#&gt; 24 oxyria digina           </span>
<span class="co">#&gt; 25 oxyria digyna           </span>
<span class="co">#&gt; 26 pedicularis hirsuta     </span>
<span class="co">#&gt; 27 poa alpina              </span>
<span class="co">#&gt; 28 poa arctica             </span>
<span class="co">#&gt; 29 poa pratensis           </span>
<span class="co">#&gt; 30 polytrichum piliferum   </span>
<span class="co">#&gt; 31 polytrichum sp          </span>
<span class="co">#&gt; 32 potentilla hyparctica   </span>
<span class="co">#&gt; 33 ranunculus sulphureus   </span>
<span class="co">#&gt; 34 salix polaris           </span>
<span class="co">#&gt; 35 sanionia sp             </span>
<span class="co">#&gt; 36 saxifraga cernua        </span>
<span class="co">#&gt; 37 saxifraga cespitosa     </span>
<span class="co">#&gt; 38 saxifraga hirculus      </span>
<span class="co">#&gt; 39 saxifraga oppositifolia </span>
<span class="co">#&gt; 40 silene acaulis          </span>
<span class="co">#&gt; 41 stellaria longipes      </span>
<span class="co">#&gt; 42 syntrichia ruralis      </span>
<span class="co">#&gt; 43 tomentypnum nitens      </span>
<span class="co">#&gt; 44 trisetum spicatum</span></code></pre></div>
<p>4 different versions of <em>oxyra digyna</em>!
rename
alternative would be to use a dictionary.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>Taxon <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">Taxon</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oxiria digyna"</span>, <span class="st">"oxyria digina"</span>, <span class="st">"oxyra digyna"</span><span class="op">)</span>, <span class="st">"oxyria digyna"</span>, <span class="va">Taxon</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; mutate: changed 28 values (&lt;1%) of 'Taxon' (0 new NA)</span></code></pre></div>
</div>
<div id="visualise-data" class="section level3" number="5.2.8">
<h3>
<span class="header-section-number">5.2.8</span> Visualise data<a class="anchor" aria-label="anchor" href="#visualise-data"><i class="fas fa-link"></i></a>
</h3>
<p>Some errors and problems in the data are difficult to detect.
Checking if the measurements are realistic is nearly impossible by looking at a dataframe.
For this, visualising the data is much more effective.</p>
<p>Make histograms, this shows the range of the values</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Value</span>, fill <span class="op">=</span> <span class="va">Gradient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green4"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="5-2_data_curation_files/figure-html/hist-1.png" width="672"></div>
<p>Note that the size traits (height, mass, area and thickness) have very long tails.
It is common to log transform such variables to better see the full range of the variables.</p>
<p>Leaf area has a huge tail and goes up to almost 20’000 cm<sup>2</sup>.
This would be a leaf of almost 2 m<sup>2</sup>, which is nearly impossible.
This value needs to be checked, it could be a typo.</p>
<p>Let’s log transform the size traits.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"Plant_Height_cm"</span>,
    <span class="st">"Wet_Mass_g"</span>,
    <span class="st">"Dry_Mass_g"</span>,
    <span class="st">"Leaf_Area_cm2"</span>,
    <span class="st">"Leaf_Thickness_mm"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>, <span class="va">Value</span><span class="op">)</span>,
    Trait <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">Trait</span>,
                   <span class="st">"Plant_Height_cm"</span> <span class="op">=</span> <span class="st">"Plant_Height_cm_log"</span>,
                   <span class="st">"Wet_Mass_g"</span> <span class="op">=</span> <span class="st">"Wet_Mass_g_log"</span>,
                   <span class="st">"Dry_Mass_g"</span> <span class="op">=</span> <span class="st">"Dry_Mass_g_log"</span>,
                   <span class="st">"Leaf_Area_cm2"</span> <span class="op">=</span> <span class="st">"Leaf_Area_cm2_log"</span>,
                   <span class="st">"Leaf_Thickness_mm"</span> <span class="op">=</span> <span class="st">"Thickness_mm_log"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in log(Value): NaNs produced</span>
<span class="co">#&gt; mutate: changed 5,428 values (48%) of 'Trait' (0 new NA)</span>
<span class="co">#&gt;         changed 5,428 values (48%) of 'Value' (0 new NA)</span></code></pre></div>
<p>And make plot again.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Value</span>, fill <span class="op">=</span> <span class="va">Gradient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green4"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="5-2_data_curation_files/figure-html/hist-log-1.png" width="672"></div>
<p>The size traits are now easier to read.</p>
<p>Another way to check the data is to plot correlated values against each other.
In this dataset, we can plot dry mass against leaf area. We would expect a positive correlation between the two variables, where large leaves have a higher dry mass.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">Trait</span>, values_from <span class="op">=</span> <span class="va">Value</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dry_Mass_g_log</span>, y <span class="op">=</span> <span class="va">Leaf_Area_cm2_log</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We can clearly see the outlier that has a 2 m<sup>2</sup> leaf.
We can also see that there is a cloud of points that is separate from the rest of the data.
These data have a sensible leaf area but the dry weight is too small.
It is possible that they were measured in the wrong unit.</p>
<!-- Add lines to the plot! -->

</div>
</div>
<div id="plant-community-composition-data" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Plant community composition data<a class="anchor" aria-label="anchor" href="#plant-community-composition-data"><i class="fas fa-link"></i></a>
</h2>
<p>For this tutorial you will need the <em>tidyverse</em>, <em>vegan</em>, <em>ggvegan</em> and <em>broom</em> package.</p>
<p>We will use the data from PFTC3 and 5 from Peru.</p>
<p><strong>Download data</strong></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Between-the-Fjords/dataDownloader">dataDownloader</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dataDownloader/man/get_file.html">get_file</a></span><span class="op">(</span>node <span class="op">=</span> <span class="st">"gs8u6"</span>,
         file <span class="op">=</span> <span class="st">"PFTC3-Puna-PFTC5_Peru_2018-2020_CommunityCover_clean.csv"</span>,
         path <span class="op">=</span> <span class="st">"clean_data"</span>,
         remote_path <span class="op">=</span> <span class="st">"community"</span><span class="op">)</span></code></pre></div>
<p>This dataset contains percentage cover for 143 species along an elevational gradients in Peru.
Three different treatments related to fire history: control (C), burnt (B) and newly burnt (NB)).
For more information about the sites and measurements see <a href="https://github.com/Plant-Functional-Trait-Course/pftc3_punaproject_pftc5">here</a>.</p>
<p>To read in the data use the code below.
Note that we remove the treatment <em>BB</em> which has only a few observation from one site.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/PFTC3-Puna-PFTC5_Peru_2018-2020_CommunityCover_clean.csv"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">!=</span> <span class="st">"BB"</span><span class="op">)</span>
<span class="co">#&gt; Rows: 3665 Columns: 15</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr (8): season, month, site, treatment, family, functional_group, taxon, co...</span>
<span class="co">#&gt; dbl (7): year, plot_id, cover, burn_year, elevation, latitude, longitude</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></code></pre></div>
<div id="diversity-indices" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Diversity indices<a class="anchor" aria-label="anchor" href="#diversity-indices"><i class="fas fa-link"></i></a>
</h3>
<p>One way to quantify the number of species species is to calculate diversity indices.
Some common indices are species <em>richness</em>, <em>diversity</em> and <em>evenness</em>.</p>
<p>To calculate these indices we are using the <em>vegan package</em>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## Calculate responses</span>
<span class="va">diversity_index</span> <span class="op">&lt;-</span> <span class="va">comm</span>  |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">site</span>, <span class="va">elevation</span>, <span class="va">treatment</span>, <span class="va">plot_id</span><span class="op">)</span>  |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise</a></span><span class="op">(</span>richness <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
            diversity <span class="op">=</span> <span class="fu">diversity</span><span class="op">(</span><span class="va">cover</span><span class="op">)</span>,
            evenness <span class="op">=</span> <span class="va">diversity</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">richness</span><span class="op">)</span><span class="op">)</span>  |&gt; 
  <span class="co"># make long dataframe</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">richness</span><span class="op">:</span><span class="va">evenness</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"index"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">index</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"richness"</span>, <span class="st">"diversity"</span>, <span class="st">"evenness"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'year', 'month', 'site', 'elevation',</span>
<span class="co">#&gt; 'treatment'. You can override using the `.groups` argument.</span></code></pre></div>
<p>We can now test if these diversity indices are different between the sites along the elevational gradient and the treatments.
We will use a simple linear model with diversity index as response and the interaction of elevation and treatment as predictor.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">diversity_result</span> <span class="op">&lt;-</span> <span class="va">diversity_index</span>  |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"NB"</span><span class="op">)</span><span class="op">)</span>  |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">treatment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"NB"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span>  |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">)</span>  |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">elevation</span> <span class="op">*</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span>,
         result <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">tidy</span><span class="op">)</span><span class="op">)</span>  |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>

<span class="va">diversity_result</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="va">index</span>, <span class="va">term</span><span class="op">:</span><span class="va">p.value</span><span class="op">)</span> |&gt; 
  <span class="fu">kbl</span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
index
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
richness
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
6.39
</td>
<td style="text-align:right;">
5.11
</td>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
richness
</td>
<td style="text-align:left;">
elevation
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
2.25
</td>
<td style="text-align:right;">
0.03
</td>
</tr>
<tr>
<td style="text-align:left;">
richness
</td>
<td style="text-align:left;">
treatmentB
</td>
<td style="text-align:right;">
-15.81
</td>
<td style="text-align:right;">
7.41
</td>
<td style="text-align:right;">
-2.13
</td>
<td style="text-align:right;">
0.03
</td>
</tr>
<tr>
<td style="text-align:left;">
richness
</td>
<td style="text-align:left;">
treatmentNB
</td>
<td style="text-align:right;">
-105.11
</td>
<td style="text-align:right;">
15.57
</td>
<td style="text-align:right;">
-6.75
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
richness
</td>
<td style="text-align:left;">
elevation:treatmentB
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
2.30
</td>
<td style="text-align:right;">
0.02
</td>
</tr>
<tr>
<td style="text-align:left;">
richness
</td>
<td style="text-align:left;">
elevation:treatmentNB
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
6.44
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
diversity
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
1.59
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
3.24
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
diversity
</td>
<td style="text-align:left;">
elevation
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.53
</td>
</tr>
<tr>
<td style="text-align:left;">
diversity
</td>
<td style="text-align:left;">
treatmentB
</td>
<td style="text-align:right;">
-0.59
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
-0.83
</td>
<td style="text-align:right;">
0.41
</td>
</tr>
<tr>
<td style="text-align:left;">
diversity
</td>
<td style="text-align:left;">
treatmentNB
</td>
<td style="text-align:right;">
-7.06
</td>
<td style="text-align:right;">
1.49
</td>
<td style="text-align:right;">
-4.72
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
diversity
</td>
<td style="text-align:left;">
elevation:treatmentB
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
<tr>
<td style="text-align:left;">
diversity
</td>
<td style="text-align:left;">
elevation:treatmentNB
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
4.47
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
evenness
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
4.80
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
evenness
</td>
<td style="text-align:left;">
elevation
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-0.29
</td>
<td style="text-align:right;">
0.77
</td>
</tr>
<tr>
<td style="text-align:left;">
evenness
</td>
<td style="text-align:left;">
treatmentB
</td>
<td style="text-align:right;">
-0.06
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.79
</td>
</tr>
<tr>
<td style="text-align:left;">
evenness
</td>
<td style="text-align:left;">
treatmentNB
</td>
<td style="text-align:right;">
-1.01
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
-2.27
</td>
<td style="text-align:right;">
0.02
</td>
</tr>
<tr>
<td style="text-align:left;">
evenness
</td>
<td style="text-align:left;">
elevation:treatmentB
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.81
</td>
</tr>
<tr>
<td style="text-align:left;">
evenness
</td>
<td style="text-align:left;">
elevation:treatmentNB
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
2.16
</td>
<td style="text-align:right;">
0.03
</td>
</tr>
</tbody>
</table></div>
<p>Species richness and diversity increase for the NB treatment, but not for the other treatments.</p>
<p><strong>Check model assumptions</strong></p>
<p>To check if the model assumptions are met, we will use the <em>performance package</em>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">richness</span> <span class="op">&lt;-</span> <span class="va">diversity_index</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op">==</span> <span class="st">"richness"</span><span class="op">)</span>

<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">elevation</span> <span class="op">*</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">richness</span><span class="op">)</span>

<span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">check_model</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="va">plot</span></code></pre></div>
<p><strong>Diversity change with elevation</strong></p>
<p>We can plot the diversity indices across elevation.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">diversity_index</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">elevation</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">treatment</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span><span class="st">"Treatment"</span>, values <span class="op">=</span> <span class="va">puna_treatment_colour</span><span class="op">$</span><span class="va">colour</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span><span class="st">"Treatment"</span>, values <span class="op">=</span> <span class="va">puna_treatment_colour</span><span class="op">$</span><span class="va">colour</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Elevation m a.s.l"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="cn">FALSE</span>,
         fill <span class="op">=</span> <span class="cn">FALSE</span>,
         colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">index</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span>
<span class="co">#&gt; Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =</span>
<span class="co">#&gt; "none")` instead.</span></code></pre></div>
<div class="inline-figure"><img src="5-3_community_files/figure-html/plot-diversity-1.png" width="672"></div>
<p>Discuss restuls…</p>
</div>
<div id="multivariate-analysis---nmds-ordination" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> Multivariate analysis - NMDS ordination<a class="anchor" aria-label="anchor" href="#multivariate-analysis---nmds-ordination"><i class="fas fa-link"></i></a>
</h3>
<p>In addition to univariate descriptor of communities such as diversity indices, we might be interested in the species composition along the elevational gradient.</p>
<p>A common method is non-metric multidimensional scaling (NMDS).
A NMDS collapses information from multiple dimensions to a few dimensions.
This allows to visualise the data more easily.</p>
<p>An NMDS can be done using the <code>metaMDS()</code> function form the <em>vegan package</em>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">cover_fat</span> <span class="op">&lt;-</span> <span class="va">comm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">family</span>, <span class="op">-</span><span class="va">functional_group</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">burn_year</span><span class="op">:</span><span class="va">course</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">season</span>, <span class="va">month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"taxon"</span>, values_from <span class="op">=</span> <span class="st">"cover"</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/ungroup.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">cover_fat_spp</span> <span class="op">&lt;-</span> <span class="va">cover_fat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">year</span><span class="op">:</span><span class="va">plot_id</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span>
<span class="va">NMDS</span> <span class="op">&lt;-</span> <span class="fu">metaMDS</span><span class="op">(</span><span class="va">cover_fat_spp</span>,
                noshare <span class="op">=</span> <span class="cn">TRUE</span>,
                try <span class="op">=</span> <span class="fl">30</span>,
                trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">fNMDS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">NMDS</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">cover_fat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="va">year</span><span class="op">:</span><span class="va">plot_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Check stress… (explain what it is and why it is done)</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">NMDS_1</span> <span class="op">&lt;-</span>  <span class="fu">metaMDS</span><span class="op">(</span><span class="va">cover_fat_spp</span>, noshare <span class="op">=</span> <span class="cn">TRUE</span>, try <span class="op">=</span> <span class="fl">30</span>, k <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">NMDS_2</span> <span class="op">&lt;-</span>  <span class="fu">metaMDS</span><span class="op">(</span><span class="va">cover_fat_spp</span>, noshare <span class="op">=</span> <span class="cn">TRUE</span>, try <span class="op">=</span> <span class="fl">30</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="va">NMDS_3</span> <span class="op">&lt;-</span>  <span class="fu">metaMDS</span><span class="op">(</span><span class="va">cover_fat_spp</span>, noshare <span class="op">=</span> <span class="cn">TRUE</span>, try <span class="op">=</span> <span class="fl">30</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
  <span class="va">NMDS_4</span> <span class="op">&lt;-</span>  <span class="fu">metaMDS</span><span class="op">(</span><span class="va">cover_fat_spp</span>, noshare <span class="op">=</span> <span class="cn">TRUE</span>, try <span class="op">=</span> <span class="fl">30</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
  <span class="va">NMDS_5</span> <span class="op">&lt;-</span>  <span class="fu">metaMDS</span><span class="op">(</span><span class="va">cover_fat_spp</span>, noshare <span class="op">=</span> <span class="cn">TRUE</span>, try <span class="op">=</span> <span class="fl">30</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
  <span class="va">NMDS_6</span> <span class="op">&lt;-</span>  <span class="fu">metaMDS</span><span class="op">(</span><span class="va">cover_fat_spp</span>, noshare <span class="op">=</span> <span class="cn">TRUE</span>, try <span class="op">=</span> <span class="fl">30</span>, k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
    stress <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">NMDS_1</span><span class="op">$</span><span class="va">stress</span>, <span class="va">NMDS_2</span><span class="op">$</span><span class="va">stress</span>, <span class="va">NMDS_3</span><span class="op">$</span><span class="va">stress</span>, <span class="va">NMDS_4</span><span class="op">$</span><span class="va">stress</span>, <span class="va">NMDS_5</span><span class="op">$</span><span class="va">stress</span>, <span class="va">NMDS_6</span><span class="op">$</span><span class="va">stress</span><span class="op">)</span>,
    dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dimensions</span>, y <span class="op">=</span> <span class="va">stress</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Square root transformation
#&gt; Wisconsin double standardization
#&gt; Using step-across dissimilarities:
#&gt; Too long or NA distances: 708 out of 21945 (3.2%)
#&gt; Stepping across 21945 dissimilarities...
#&gt; Connectivity of distance matrix with threshold dissimilarity 1 
#&gt; Data are connected
#&gt; Run 0 stress 0.3669738 
#&gt; Run 1 stress 0.3966017 
#&gt; Run 2 stress 0.5190487 
#&gt; Run 3 stress 0.5744689 
#&gt; Run 4 stress 0.4411074 
#&gt; Run 5 stress 0.574498 
#&gt; Run 6 stress 0.5139886 
#&gt; Run 7 stress 0.5745687 
#&gt; Run 8 stress 0.4332597 
#&gt; Run 9 stress 0.5172638 
#&gt; Run 10 stress 0.5745844 
#&gt; Run 11 stress 0.4944197 
#&gt; Run 12 stress 0.417065 
#&gt; Run 13 stress 0.5063905 
#&gt; Run 14 stress 0.4471289 
#&gt; Run 15 stress 0.5745715 
#&gt; Run 16 stress 0.574576 
#&gt; Run 17 stress 0.4223127 
#&gt; Run 18 stress 0.5186829 
#&gt; Run 19 stress 0.5078911 
#&gt; Run 20 stress 0.5160806 
#&gt; Run 21 stress 0.4569249 
#&gt; Run 22 stress 0.4483193 
#&gt; Run 23 stress 0.4329702 
#&gt; Run 24 stress 0.5744662 
#&gt; Run 25 stress 0.5744928 
#&gt; Run 26 stress 0.5124116 
#&gt; Run 27 stress 0.5167869 
#&gt; Run 28 stress 0.5030833 
#&gt; Run 29 stress 0.4654018 
#&gt; Run 30 stress 0.511481 
#&gt; *** No convergence -- monoMDS stopping criteria:
#&gt;     11: stress ratio &gt; sratmax
#&gt;     19: scale factor of the gradient &lt; sfgrmin
#&gt; Square root transformation
#&gt; Wisconsin double standardization
#&gt; Using step-across dissimilarities:
#&gt; Too long or NA distances: 708 out of 21945 (3.2%)
#&gt; Stepping across 21945 dissimilarities...
#&gt; Connectivity of distance matrix with threshold dissimilarity 1 
#&gt; Data are connected
#&gt; Run 0 stress 0.20073 
#&gt; Run 1 stress 0.2182501 
#&gt; Run 2 stress 0.2083237 
#&gt; Run 3 stress 0.2005945 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.006078256  max resid 0.06685748 
#&gt; Run 4 stress 0.2007521 
#&gt; ... Procrustes: rmse 0.006366959  max resid 0.06729406 
#&gt; Run 5 stress 0.2355802 
#&gt; Run 6 stress 0.2225095 
#&gt; Run 7 stress 0.2011206 
#&gt; Run 8 stress 0.214649 
#&gt; Run 9 stress 0.2086967 
#&gt; Run 10 stress 0.2082084 
#&gt; Run 11 stress 0.2004971 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.00217813  max resid 0.02930483 
#&gt; Run 12 stress 0.2448126 
#&gt; Run 13 stress 0.2004924 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.0009213377  max resid 0.01260201 
#&gt; Run 14 stress 0.2366596 
#&gt; Run 15 stress 0.2219288 
#&gt; Run 16 stress 0.2007299 
#&gt; ... Procrustes: rmse 0.005094979  max resid 0.06565216 
#&gt; Run 17 stress 0.2007521 
#&gt; ... Procrustes: rmse 0.005304626  max resid 0.06601554 
#&gt; Run 18 stress 0.2200119 
#&gt; Run 19 stress 0.2465379 
#&gt; Run 20 stress 0.201122 
#&gt; Run 21 stress 0.212618 
#&gt; Run 22 stress 0.2490223 
#&gt; Run 23 stress 0.2456565 
#&gt; Run 24 stress 0.2351948 
#&gt; Run 25 stress 0.2011839 
#&gt; Run 26 stress 0.2005931 
#&gt; ... Procrustes: rmse 0.002075318  max resid 0.02814701 
#&gt; Run 27 stress 0.2007299 
#&gt; ... Procrustes: rmse 0.00506658  max resid 0.06559041 
#&gt; Run 28 stress 0.2110259 
#&gt; Run 29 stress 0.2136821 
#&gt; Run 30 stress 0.2004925 
#&gt; ... Procrustes: rmse 7.2719e-05  max resid 0.0005361616 
#&gt; ... Similar to previous best
#&gt; *** Solution reached
#&gt; Square root transformation
#&gt; Wisconsin double standardization
#&gt; Using step-across dissimilarities:
#&gt; Too long or NA distances: 708 out of 21945 (3.2%)
#&gt; Stepping across 21945 dissimilarities...
#&gt; Connectivity of distance matrix with threshold dissimilarity 1 
#&gt; Data are connected
#&gt; Run 0 stress 0.1496032 
#&gt; Run 1 stress 0.1496028 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.0004109622  max resid 0.004798846 
#&gt; ... Similar to previous best
#&gt; Run 2 stress 0.1496028 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 3.385516e-05  max resid 0.0001892113 
#&gt; ... Similar to previous best
#&gt; Run 3 stress 0.1496029 
#&gt; ... Procrustes: rmse 8.602209e-05  max resid 0.0004481636 
#&gt; ... Similar to previous best
#&gt; Run 4 stress 0.1496026 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.0001241784  max resid 0.001492955 
#&gt; ... Similar to previous best
#&gt; Run 5 stress 0.1496034 
#&gt; ... Procrustes: rmse 0.0003495415  max resid 0.003669896 
#&gt; ... Similar to previous best
#&gt; Run 6 stress 0.1496046 
#&gt; ... Procrustes: rmse 0.002793576  max resid 0.03467881 
#&gt; Run 7 stress 0.1496048 
#&gt; ... Procrustes: rmse 0.002795569  max resid 0.03469251 
#&gt; Run 8 stress 0.1496043 
#&gt; ... Procrustes: rmse 0.002785784  max resid 0.03460863 
#&gt; Run 9 stress 0.1496042 
#&gt; ... Procrustes: rmse 0.002779486  max resid 0.03453958 
#&gt; Run 10 stress 0.149612 
#&gt; ... Procrustes: rmse 0.002905389  max resid 0.03510331 
#&gt; Run 11 stress 0.1496031 
#&gt; ... Procrustes: rmse 0.0002450591  max resid 0.002602491 
#&gt; ... Similar to previous best
#&gt; Run 12 stress 0.1496045 
#&gt; ... Procrustes: rmse 0.002794077  max resid 0.0346816 
#&gt; Run 13 stress 0.1496031 
#&gt; ... Procrustes: rmse 0.0001597965  max resid 0.001086928 
#&gt; ... Similar to previous best
#&gt; Run 14 stress 0.1496047 
#&gt; ... Procrustes: rmse 0.002796931  max resid 0.03470258 
#&gt; Run 15 stress 0.1496029 
#&gt; ... Procrustes: rmse 0.0001716801  max resid 0.001949172 
#&gt; ... Similar to previous best
#&gt; Run 16 stress 0.1496081 
#&gt; ... Procrustes: rmse 0.0007773416  max resid 0.006660007 
#&gt; ... Similar to previous best
#&gt; Run 17 stress 0.1496036 
#&gt; ... Procrustes: rmse 0.0003405729  max resid 0.003538791 
#&gt; ... Similar to previous best
#&gt; Run 18 stress 0.1496049 
#&gt; ... Procrustes: rmse 0.002655481  max resid 0.03292451 
#&gt; Run 19 stress 0.1496044 
#&gt; ... Procrustes: rmse 0.002672476  max resid 0.03315833 
#&gt; Run 20 stress 0.1496044 
#&gt; ... Procrustes: rmse 0.002830271  max resid 0.03504831 
#&gt; Run 21 stress 0.149603 
#&gt; ... Procrustes: rmse 0.000143452  max resid 0.0013587 
#&gt; ... Similar to previous best
#&gt; Run 22 stress 0.1496151 
#&gt; ... Procrustes: rmse 0.002946852  max resid 0.03519211 
#&gt; Run 23 stress 0.1496042 
#&gt; ... Procrustes: rmse 0.0004387517  max resid 0.004368286 
#&gt; ... Similar to previous best
#&gt; Run 24 stress 0.1496047 
#&gt; ... Procrustes: rmse 0.002792242  max resid 0.03466513 
#&gt; Run 25 stress 0.1496095 
#&gt; ... Procrustes: rmse 0.002869195  max resid 0.03500028 
#&gt; Run 26 stress 0.1496031 
#&gt; ... Procrustes: rmse 0.000161386  max resid 0.001007451 
#&gt; ... Similar to previous best
#&gt; Run 27 stress 0.149604 
#&gt; ... Procrustes: rmse 0.0003265561  max resid 0.003195434 
#&gt; ... Similar to previous best
#&gt; Run 28 stress 0.1496034 
#&gt; ... Procrustes: rmse 0.0003205402  max resid 0.003133215 
#&gt; ... Similar to previous best
#&gt; Run 29 stress 0.1496043 
#&gt; ... Procrustes: rmse 0.002784911  max resid 0.03460711 
#&gt; Run 30 stress 0.1496035 
#&gt; ... Procrustes: rmse 0.0003698297  max resid 0.003956172 
#&gt; ... Similar to previous best
#&gt; *** Solution reached
#&gt; Square root transformation
#&gt; Wisconsin double standardization
#&gt; Using step-across dissimilarities:
#&gt; Too long or NA distances: 708 out of 21945 (3.2%)
#&gt; Stepping across 21945 dissimilarities...
#&gt; Connectivity of distance matrix with threshold dissimilarity 1 
#&gt; Data are connected
#&gt; Run 0 stress 0.1236357 
#&gt; Run 1 stress 0.1240154 
#&gt; ... Procrustes: rmse 0.03150932  max resid 0.09941104 
#&gt; Run 2 stress 0.1241406 
#&gt; Run 3 stress 0.1240211 
#&gt; ... Procrustes: rmse 0.03230265  max resid 0.09941862 
#&gt; Run 4 stress 0.1236349 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.0001169962  max resid 0.0006613207 
#&gt; ... Similar to previous best
#&gt; Run 5 stress 0.1240922 
#&gt; ... Procrustes: rmse 0.008361968  max resid 0.09420276 
#&gt; Run 6 stress 0.1238104 
#&gt; ... Procrustes: rmse 0.02818918  max resid 0.1205201 
#&gt; Run 7 stress 0.1240505 
#&gt; ... Procrustes: rmse 0.0306759  max resid 0.1001498 
#&gt; Run 8 stress 0.1245961 
#&gt; Run 9 stress 0.1240572 
#&gt; ... Procrustes: rmse 0.0290986  max resid 0.1001645 
#&gt; Run 10 stress 0.1236349 
#&gt; ... Procrustes: rmse 0.00089162  max resid 0.007473249 
#&gt; ... Similar to previous best
#&gt; Run 11 stress 0.1238541 
#&gt; ... Procrustes: rmse 0.02383616  max resid 0.1284415 
#&gt; Run 12 stress 0.1238256 
#&gt; ... Procrustes: rmse 0.02317068  max resid 0.1002362 
#&gt; Run 13 stress 0.1240649 
#&gt; ... Procrustes: rmse 0.03346715  max resid 0.1028719 
#&gt; Run 14 stress 0.1240161 
#&gt; ... Procrustes: rmse 0.0118338  max resid 0.09619942 
#&gt; Run 15 stress 0.1237134 
#&gt; ... Procrustes: rmse 0.02723612  max resid 0.09894111 
#&gt; Run 16 stress 0.1236339 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.0006986775  max resid 0.004219814 
#&gt; ... Similar to previous best
#&gt; Run 17 stress 0.1237204 
#&gt; ... Procrustes: rmse 0.02645367  max resid 0.09898438 
#&gt; Run 18 stress 0.1239427 
#&gt; ... Procrustes: rmse 0.02043016  max resid 0.100191 
#&gt; Run 19 stress 0.1229504 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.02501793  max resid 0.1597669 
#&gt; Run 20 stress 0.1240791 
#&gt; Run 21 stress 0.1229588 
#&gt; ... Procrustes: rmse 0.001804713  max resid 0.01919788 
#&gt; Run 22 stress 0.1236982 
#&gt; Run 23 stress 0.1239967 
#&gt; Run 24 stress 0.1240594 
#&gt; Run 25 stress 0.1236348 
#&gt; Run 26 stress 0.1237123 
#&gt; Run 27 stress 0.1240147 
#&gt; Run 28 stress 0.1240213 
#&gt; Run 29 stress 0.12396 
#&gt; Run 30 stress 0.1240317 
#&gt; *** No convergence -- monoMDS stopping criteria:
#&gt;     23: no. of iterations &gt;= maxit
#&gt;      7: stress ratio &gt; sratmax
#&gt; Square root transformation
#&gt; Wisconsin double standardization
#&gt; Using step-across dissimilarities:
#&gt; Too long or NA distances: 708 out of 21945 (3.2%)
#&gt; Stepping across 21945 dissimilarities...
#&gt; Connectivity of distance matrix with threshold dissimilarity 1 
#&gt; Data are connected
#&gt; Run 0 stress 0.1014859 
#&gt; Run 1 stress 0.1014859 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.001496211  max resid 0.01341869 
#&gt; Run 2 stress 0.1014882 
#&gt; ... Procrustes: rmse 0.0003613118  max resid 0.0030562 
#&gt; ... Similar to previous best
#&gt; Run 3 stress 0.1019811 
#&gt; ... Procrustes: rmse 0.01013506  max resid 0.05227495 
#&gt; Run 4 stress 0.1015739 
#&gt; ... Procrustes: rmse 0.003590735  max resid 0.02819999 
#&gt; Run 5 stress 0.1015006 
#&gt; ... Procrustes: rmse 0.001874394  max resid 0.01532635 
#&gt; Run 6 stress 0.1018107 
#&gt; ... Procrustes: rmse 0.008071745  max resid 0.04308882 
#&gt; Run 7 stress 0.1014854 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.001301816  max resid 0.01229766 
#&gt; Run 8 stress 0.1016368 
#&gt; ... Procrustes: rmse 0.00415404  max resid 0.04176875 
#&gt; Run 9 stress 0.101771 
#&gt; ... Procrustes: rmse 0.005992127  max resid 0.05172668 
#&gt; Run 10 stress 0.101486 
#&gt; ... Procrustes: rmse 0.001163481  max resid 0.009342148 
#&gt; ... Similar to previous best
#&gt; Run 11 stress 0.1014844 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.0005162083  max resid 0.003108608 
#&gt; ... Similar to previous best
#&gt; Run 12 stress 0.1020294 
#&gt; Run 13 stress 0.1015629 
#&gt; ... Procrustes: rmse 0.003142189  max resid 0.01789825 
#&gt; Run 14 stress 0.1014907 
#&gt; ... Procrustes: rmse 0.000584355  max resid 0.005003165 
#&gt; ... Similar to previous best
#&gt; Run 15 stress 0.1014848 
#&gt; ... Procrustes: rmse 0.0008144449  max resid 0.007596159 
#&gt; ... Similar to previous best
#&gt; Run 16 stress 0.1014845 
#&gt; ... Procrustes: rmse 0.0004405542  max resid 0.004920053 
#&gt; ... Similar to previous best
#&gt; Run 17 stress 0.1012551 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.02773564  max resid 0.1657609 
#&gt; Run 18 stress 0.1021218 
#&gt; Run 19 stress 0.1018503 
#&gt; Run 20 stress 0.1014859 
#&gt; ... Procrustes: rmse 0.02767256  max resid 0.1646763 
#&gt; Run 21 stress 0.101487 
#&gt; ... Procrustes: rmse 0.02771247  max resid 0.1652471 
#&gt; Run 22 stress 0.1018845 
#&gt; Run 23 stress 0.1023329 
#&gt; Run 24 stress 0.1014867 
#&gt; ... Procrustes: rmse 0.02778127  max resid 0.1637971 
#&gt; Run 25 stress 0.1013431 
#&gt; ... Procrustes: rmse 0.009275203  max resid 0.05384371 
#&gt; Run 26 stress 0.1012622 
#&gt; ... Procrustes: rmse 0.006106135  max resid 0.04427436 
#&gt; Run 27 stress 0.1015213 
#&gt; ... Procrustes: rmse 0.02779551  max resid 0.1627817 
#&gt; Run 28 stress 0.1016594 
#&gt; ... Procrustes: rmse 0.02781834  max resid 0.1594333 
#&gt; Run 29 stress 0.1015512 
#&gt; ... Procrustes: rmse 0.02786594  max resid 0.1633327 
#&gt; Run 30 stress 0.1015087 
#&gt; ... Procrustes: rmse 0.0277089  max resid 0.1632642 
#&gt; *** No convergence -- monoMDS stopping criteria:
#&gt;     23: no. of iterations &gt;= maxit
#&gt;      7: stress ratio &gt; sratmax
#&gt; Square root transformation
#&gt; Wisconsin double standardization
#&gt; Using step-across dissimilarities:
#&gt; Too long or NA distances: 708 out of 21945 (3.2%)
#&gt; Stepping across 21945 dissimilarities...
#&gt; Connectivity of distance matrix with threshold dissimilarity 1 
#&gt; Data are connected
#&gt; Run 0 stress 0.0871146 
#&gt; Run 1 stress 0.08846572 
#&gt; Run 2 stress 0.08713978 
#&gt; ... Procrustes: rmse 0.003713778  max resid 0.02036551 
#&gt; Run 3 stress 0.08878503 
#&gt; Run 4 stress 0.08735978 
#&gt; ... Procrustes: rmse 0.005332886  max resid 0.0277197 
#&gt; Run 5 stress 0.08943071 
#&gt; Run 6 stress 0.08942787 
#&gt; Run 7 stress 0.08719705 
#&gt; ... Procrustes: rmse 0.003194158  max resid 0.01283403 
#&gt; Run 8 stress 0.08757549 
#&gt; ... Procrustes: rmse 0.01025835  max resid 0.04840186 
#&gt; Run 9 stress 0.08980633 
#&gt; Run 10 stress 0.08778312 
#&gt; Run 11 stress 0.08898063 
#&gt; Run 12 stress 0.08979292 
#&gt; Run 13 stress 0.08716465 
#&gt; ... Procrustes: rmse 0.002855812  max resid 0.01809449 
#&gt; Run 14 stress 0.08880298 
#&gt; Run 15 stress 0.08992085 
#&gt; Run 16 stress 0.08726124 
#&gt; ... Procrustes: rmse 0.006536252  max resid 0.03952786 
#&gt; Run 17 stress 0.08927162 
#&gt; Run 18 stress 0.08747088 
#&gt; ... Procrustes: rmse 0.009478915  max resid 0.04331799 
#&gt; Run 19 stress 0.08725912 
#&gt; ... Procrustes: rmse 0.006182781  max resid 0.04046836 
#&gt; Run 20 stress 0.08713052 
#&gt; ... Procrustes: rmse 0.00294201  max resid 0.01589794 
#&gt; Run 21 stress 0.08711406 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.003584975  max resid 0.02486928 
#&gt; Run 22 stress 0.08744816 
#&gt; ... Procrustes: rmse 0.008395644  max resid 0.04549463 
#&gt; Run 23 stress 0.08718053 
#&gt; ... Procrustes: rmse 0.005427267  max resid 0.03738844 
#&gt; Run 24 stress 0.08721509 
#&gt; ... Procrustes: rmse 0.006264433  max resid 0.03730534 
#&gt; Run 25 stress 0.08721308 
#&gt; ... Procrustes: rmse 0.00452053  max resid 0.01489785 
#&gt; Run 26 stress 0.08719441 
#&gt; ... Procrustes: rmse 0.005963353  max resid 0.02706668 
#&gt; Run 27 stress 0.08711333 
#&gt; ... New best solution
#&gt; ... Procrustes: rmse 0.002752416  max resid 0.01551721 
#&gt; Run 28 stress 0.08715922 
#&gt; ... Procrustes: rmse 0.003436136  max resid 0.02777786 
#&gt; Run 29 stress 0.08712261 
#&gt; ... Procrustes: rmse 0.002925042  max resid 0.02545719 
#&gt; Run 30 stress 0.08713603 
#&gt; ... Procrustes: rmse 0.00156582  max resid 0.007586865 
#&gt; ... Similar to previous best
#&gt; *** Solution reached</code></pre>
<div class="inline-figure"><img src="5-3_community_files/figure-html/stressplot-calc-1.png" width="672"></div>
<p>Discuss the results of the stress plot and what desicion is taken. How many dimesions are chosen.</p>
<p><strong>Visualise</strong></p>
<p>The output of an ordination can be visualised.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">fNMDS</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">treatment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"NB"</span><span class="op">)</span><span class="op">)</span>,
         site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WAY"</span>, <span class="st">"ACJ"</span>, <span class="st">"PIL"</span>, <span class="st">"TRE"</span>, <span class="st">"QUE"</span>, <span class="st">"OCC"</span><span class="op">)</span><span class="op">)</span>,
         season <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="st">"dry_season"</span>,
                          <span class="st">"Dry season"</span>,
                          <span class="st">"Wet season"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">NMDS1</span>, y <span class="op">=</span> <span class="va">NMDS2</span>, colour <span class="op">=</span> <span class="va">site</span>, shape <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span><span class="st">"Site"</span>, values <span class="op">=</span> <span class="va">puna_site_colour</span><span class="op">$</span><span class="va">colour</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span><span class="st">"Treatment"</span>, values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">season</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="5-3_community_files/figure-html/plot-nmds-1.png" width="672"></div>
<p>Discuss results.</p>

</div>
</div>
<div id="bootstrapping-method" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Bootstrapping method<a class="anchor" aria-label="anchor" href="#bootstrapping-method"><i class="fas fa-link"></i></a>
</h2>
<!-- fig.align = 'right',  -->
<div class="inline-figure"><img src="images/resources/Traitstrap_hex.png" width="15%" style="float:right; padding:8px"></div>
<p>This vignette explains how to use the traitstrap package (Telford et al).
For more details on the methods see Maitner et al.</p>
<p>First of all, relax and turn on some music. We have prepared the <a href="https://tinyurl.com/traitstrap">traitstrap playlist</a> for you!</p>
<div id="the-aim-of-traitstrap" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> The aim of traitstrap<a class="anchor" aria-label="anchor" href="#the-aim-of-traitstrap"><i class="fas fa-link"></i></a>
</h3>
<p>Trait distributions can be used to infer the importance of community assembly processes and the role of climate drivers in shaping species and community responses to climate change.
Community ecology has typically focused on the <strong>mean</strong>, however the <strong>higher moments</strong> (variance, skewness, and kurtosis) of trait distributions can reveal information about the various processes shaping species diversity.</p>
<div class="inline-figure"><img src="images/resources/true-dist.png" width="90%"></div>
<p>Measuring trait distributions is often difficult and time-consuming as it requires information on measuring trait values of all individuals present.
Sampling protocols often limit sampling to a non-representative subset of the community, or rely upon species-level average traits values calculated in other locations or across many locations.</p>
<p>Traditionally the moments of trait distributions have been estimated using weighting approaches that rely on the average traits of species weighted by some measure of abundance within the community.
Such <strong>community-weighted</strong> trait moments methods assume that a species’ trait expression can be adequately represented by the mean, ignoring intraspecific trait variation.</p>
<p>To more accurately estimate local trait distributions, trait sampling should thus occur both across multiple individuals within each species, and across multiple locations or experimental treatments across the extent of the study in order to capture both inter- and intra-specific variability.</p>
<div class="inline-figure"><img src="images/resources/comm-boot.png" width="90%"></div>
<p><strong>Traitstrap</strong> is an <strong>R package</strong> to estimate the moments of community trait distributions using a <strong>bootstrapping approach</strong>.
Further, this package uses a hierarchical sampling design, which allows accounting for incomplete trait collections, traits from different spatial or temporal levels (e.g. local traits vs. databases), taxonomic hierarchies (e.g., species vs genus) and experimental designs (e.g., multiple sites, or treated vs. control sampling units).</p>
<p>The package has three <strong>main functions</strong>:</p>
<ul>
<li>
<strong>trait imputation</strong> function which allows to account for intraspecific trait variation and hierarchical sampling design.</li>
<li>a resample method using <strong>bootstrapping</strong> (parametric or nonparametric method) to calculate community weighted mean and happy moments (variance, skewness and kurtosis).</li>
<li>a <strong>summary function</strong> that summarizes the trait moments and calculates confidence intervals.</li>
</ul>
<p>Note that for this tutorial we are calling the mean and the higher moments the happy moments :-)</p>
</div>
<div id="the-data" class="section level3" number="5.4.2">
<h3>
<span class="header-section-number">5.4.2</span> The data<a class="anchor" aria-label="anchor" href="#the-data"><i class="fas fa-link"></i></a>
</h3>
<p>For this vignette we will use part of a vascular plant dataset from two sites near Longyearbyen on Svalbard.
The data was collected during the Plant Functional Trait Course in 2018 and contains data on the plant community composition and functional traits.
For more details see this <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_4_Svalbard">GitHub repo</a></p>
<p>Note that some of the species names have been adapted.</p>
</div>
<div id="organize-your-data" class="section level3" number="5.4.3">
<h3>
<span class="header-section-number">5.4.3</span> Organize your data<a class="anchor" aria-label="anchor" href="#organize-your-data"><i class="fas fa-link"></i></a>
</h3>
<p>To run traitstrap two datasets are required:</p>
<ul>
<li>one dataset with information on abundance (e.g. biomass, size, cover, etc.) of the community, which is used to weight species traits by abundance in the community.</li>
<li>one dataset with the traits for each species (or as many species and individuals you have data for) in your community.</li>
</ul>
<p>The datasets need to be organized in a <strong>tidy</strong> and <strong>long</strong> format and certain columns (see below) are required, but the naming of these columns are up to the user.</p>
<p>Let us have a look at these datasets in an example.</p>
<p>The <strong>community data</strong> should have information the abundance of species in the community.
This dataset will be used to weigh the traits by species abundance.
Note that abundance can also be cover, size, biomass, or something similar.</p>
<p>In this example the contains species names (e.g. <strong>Taxon</strong>), cover of each species per plot (e.g. <strong>Cover</strong>) and two columns with information about the <strong>hierarchy</strong> (i.e. <strong>Site</strong> and <strong>PlotID</strong>).</p>
<pre><code>#&gt; # A tibble: 110 × 4
#&gt;    Taxon             Cover Site  PlotID
#&gt;    &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
#&gt;  1 alopecurus ovatus   0.5 1     B     
#&gt;  2 alopecurus ovatus   1   1     C     
#&gt;  3 alopecurus ovatus   1   1     D     
#&gt;  4 alopecurus ovatus   2   1     F     
#&gt;  5 alopecurus ovatus   0.1 1     G     
#&gt;  6 bistorta vigdis    10   1     A     
#&gt;  7 bistorta vigdis    25   1     B     
#&gt;  8 bistorta vigdis    10   1     C     
#&gt;  9 bistorta vigdis     2   1     D     
#&gt; 10 bistorta vigdis     1   1     F     
#&gt; # … with 100 more rows</code></pre>
<p>The <strong>trait data</strong> should contain information about traits and trait values for as many species and individuals in the community data as possible.
The data should be organized in the same way as the community data and should have corresponding columns.
In this example the trait data contains <strong>Taxon</strong>, <strong>Site</strong> and <strong>PlotID</strong> as well as <strong>Trait</strong> and <strong>Value</strong>.</p>
<pre><code>#&gt; # A tibble: 749 × 5
#&gt;    Taxon                   Site  PlotID Trait         Value
#&gt;    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;
#&gt;  1 saxifraga oppositifolia 1     A      Wet_Mass_g 0.000695
#&gt;  2 bistorta vigdis         1     C      Wet_Mass_g 0.0105  
#&gt;  3 festuca rubra           2     C      Wet_Mass_g 0.00724 
#&gt;  4 bistorta vigdis         1     C      Wet_Mass_g 0.0189  
#&gt;  5 equisetum arvense       1     E      Wet_Mass_g 0.270   
#&gt;  6 bistorta vigdis         1     B      Wet_Mass_g 0.0231  
#&gt;  7 luzula confusa          1     F      Wet_Mass_g 0.0135  
#&gt;  8 alopecurus ovatus       1     G      Wet_Mass_g 0.0234  
#&gt;  9 alopecurus ovatus       1     G      Wet_Mass_g 0.0300  
#&gt; 10 alopecurus ovatus       1     C      Wet_Mass_g 0.0267  
#&gt; # … with 739 more rows</code></pre>
</div>
<div id="trait-imputation" class="section level3" number="5.4.4">
<h3>
<span class="header-section-number">5.4.4</span> Trait imputation<a class="anchor" aria-label="anchor" href="#trait-imputation"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>trait_impute</code> function uses a hierarchical sampling design, which allows to account for incomplete trait collections, traits from different spatial or temporal levels (i.e. local traits vs. databases), different taxonomic resolution and/or experimental design.</p>
<p>The first two mandatory arguments in the function are the two datasets:
<code>comm</code> and <code>traits</code></p>
<p>The next four arguments are also mandatory and refer to specific columns in the trait or community dataset:</p>
<ul>
<li>
<code>abundance</code> which is the abundance of your species in your community dataset. This can be abundance, cover, biomass, or size, etc.</li>
<li>
<code>taxon_col</code> is the column in your community and trait data that define the species.</li>
<li>
<code>trait_col</code> is the column in your trait data that defines the traits.</li>
<li>
<code>value_col</code> is the column in your trait data that defines the trait values.</li>
</ul>
<p>All the other arguments are not mandatory.</p>
<p>With <code>scale_hierarchy</code> you can define the levels at which the traits have been collected and the order of trait imputation starting with the highest level (e.g. global database, regional, site, plot).
In the example below we have the levels <strong>Site</strong> and <strong>PlotID</strong>, starting with the highest level.</p>
<p>The <code>trait_impute</code> function will choose if available a trait value from the lowest level, i.e. species X from plot A in site 1.
If no trait value is available from that level (plot A, site 1), it will other groups in the same level and choose a trait value from species X from plot B or C at site 1.
If there is no trait available, it will move up the hierarchy to the next level and choose trait values from species X from other sites (site 2, 3, etc.).</p>
<p>The argument <code>min_n_in_samples</code> allows users to define the minimum number in samples that are chosen at each level.
If the minimum number is not reached (i.e. there are only 3 trait values at a specific level), trait values from the next higher level will be imputed, to avoid sampling the same individual several times, which could result in unrealistic variances.
The default minimum number of samples is 5.</p>
<p>In the <code>other_col</code> argument other grouping variables in the community dataset can be defined and will be kept after the trait imputation.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trait_imputation</span> <span class="op">&lt;-</span> <span class="fu">trait_impute</span><span class="op">(</span>
    <span class="co"># input data (mandatory)</span>
    comm <span class="op">=</span> <span class="va">community</span>,
    traits <span class="op">=</span> <span class="va">trait</span>,
    
    <span class="co"># specifies columns in your data (mandatory)</span>
    abundance_col <span class="op">=</span> <span class="st">"Cover"</span>,
    taxon_col <span class="op">=</span> <span class="st">"Taxon"</span>,
    trait_col <span class="op">=</span> <span class="st">"Trait"</span>,
    value_col <span class="op">=</span> <span class="st">"Value"</span>,
    
    <span class="co"># specifies sampling hierarchy</span>
    scale_hierarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site"</span>, <span class="st">"PlotID"</span><span class="op">)</span>,
    
    <span class="co"># min number of samples</span>
    min_n_in_sample <span class="op">=</span> <span class="fl">9</span>
  <span class="op">)</span>
<span class="va">trait_imputation</span>
<span class="co">#&gt; # A tibble: 4,007 × 12</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    Taxon  Cover Site  PlotID global sum_abun Trait   Value n_sample weight level</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;ord&gt;</span>
<span class="co">#&gt;  1 festu…     1 1     A      global     38.2 Wet_… 0.00724       11 0.0909 glob…</span>
<span class="co">#&gt;  2 festu…     1 1     A      global     38.2 Wet_… 0.0160        11 0.0909 glob…</span>
<span class="co">#&gt;  3 festu…     1 1     A      global     38.2 Wet_… 0.00529       11 0.0909 glob…</span>
<span class="co">#&gt;  4 festu…     1 1     A      global     38.2 Wet_… 0.0154        11 0.0909 glob…</span>
<span class="co">#&gt;  5 festu…     1 1     A      global     38.2 Wet_… 0.0066        11 0.0909 glob…</span>
<span class="co">#&gt;  6 festu…     1 1     A      global     38.2 Wet_… 0.00637       11 0.0909 glob…</span>
<span class="co">#&gt;  7 festu…     1 1     A      global     38.2 Wet_… 0.00491       11 0.0909 glob…</span>
<span class="co">#&gt;  8 festu…     1 1     A      global     38.2 Wet_… 0.0132        11 0.0909 glob…</span>
<span class="co">#&gt;  9 festu…     1 1     A      global     38.2 Wet_… 0.0233        11 0.0909 glob…</span>
<span class="co">#&gt; 10 festu…     1 1     A      global     38.2 Wet_… 0.0115        11 0.0909 glob…</span>
<span class="co">#&gt; # … with 3,997 more rows, and 1 more variable: max_n_in_sample &lt;int&gt;</span></code></pre></div>
<p>Traitstrap also allows to include taxonomy and experimental design in the trait imputation step.</p>
<p>With the argument <code>taxon_col</code> the taxonomic hierarchy for sampling can be defined.
This means if traits for a specific species are not available, trait values from the same genus will be imputed.
For this a list of the taxonomic hierarchy has to be defined (e.g. “Taxon”, “Genus”).
Note that traits from species of the same genus can have very different traits and it might not be meaningful to impute these traits.
Therefore, you should always check the trait distributions for the same genus before using taxonomic trait imputation.</p>
<p>The argument <code>treatment_col</code> allows to incorporate an experimental design where traits are imputed from the same experimental treatment or the first factor level, which is assumed to be the control.
Therefore, it is important to order the levels of a treatment in the right order, i.e. the first level has to be the control.
The imputation step can be defined at certain level using the <code>treatment_level</code> argument.
Depending on the experimental design it might make sense to impute traits at a certain level, e.g. block or site.</p>
<p>Here is an example how to include taxonomy and experimental design in the trait imputation function (code not run).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-curation-and-analysis.html#cb35-1" aria-hidden="true" tabindex="-1"></a>trait_imputation2 <span class="ot">&lt;-</span> <span class="fu">trait_impute</span>(</span>
<span id="cb35-2"><a href="data-curation-and-analysis.html#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">comm =</span> community,</span>
<span id="cb35-3"><a href="data-curation-and-analysis.html#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> trait,</span>
<span id="cb35-4"><a href="data-curation-and-analysis.html#cb35-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-5"><a href="data-curation-and-analysis.html#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_col =</span> <span class="st">"Cover"</span>,</span>
<span id="cb35-6"><a href="data-curation-and-analysis.html#cb35-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-7"><a href="data-curation-and-analysis.html#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># defining taxonomic hierarchy</span></span>
<span id="cb35-8"><a href="data-curation-and-analysis.html#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon_col =</span> <span class="fu">c</span>(<span class="st">"Taxon"</span>, <span class="st">"Genus"</span>),</span>
<span id="cb35-9"><a href="data-curation-and-analysis.html#cb35-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-10"><a href="data-curation-and-analysis.html#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trait_col =</span> <span class="st">"Trait"</span>,</span>
<span id="cb35-11"><a href="data-curation-and-analysis.html#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_col =</span> <span class="st">"Value"</span>,</span>
<span id="cb35-12"><a href="data-curation-and-analysis.html#cb35-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-13"><a href="data-curation-and-analysis.html#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale_hierarchy =</span> <span class="fu">c</span>(<span class="st">"Site"</span>, <span class="st">"PlotID"</span>),</span>
<span id="cb35-14"><a href="data-curation-and-analysis.html#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_n_in_sample =</span> <span class="dv">3</span></span>
<span id="cb35-15"><a href="data-curation-and-analysis.html#cb35-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-16"><a href="data-curation-and-analysis.html#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specifying experimental design</span></span>
<span id="cb35-17"><a href="data-curation-and-analysis.html#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_col =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb35-18"><a href="data-curation-and-analysis.html#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_level =</span> <span class="st">"Site"</span>,</span>
<span id="cb35-19"><a href="data-curation-and-analysis.html#cb35-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="nonparametric-bootstrapping" class="section level3" number="5.4.5">
<h3>
<span class="header-section-number">5.4.5</span> Nonparametric bootstrapping<a class="anchor" aria-label="anchor" href="#nonparametric-bootstrapping"><i class="fas fa-link"></i></a>
</h3>
<p>The output of the trait imputation function is then used to do a <strong>nonparametric bootstrapping</strong> using the <code>trait_np_bootstrap</code> function.</p>
<p>Nonparametric bootstrapping is a resampling method to estimate the trait moments.
The traits are re-sampled in proportion to their weight in the community (e.g. by the abundance of the species).</p>
<p>The trait values across all individuals in a community are resampled n times (<code>sample_size</code>; the default is 200) to incorporate the full spectrum of trait variation, generating n number (<code>nrep</code>; the default is 100) of trait distributions.</p>
<p>From these trait distributions the happy moments are estimated: <strong>mean</strong>, <strong>variance</strong>, <strong>skewness</strong> and <strong>kurtosis</strong>.</p>
<p>This function also allows to extract raw distributions by setting the argument <code>raw = TRUE</code>.
The raw data can be useful for visualizing the trait distributions.
If the raw data is extracted, <code>nrep</code> is forced to 1 to avoid memory issues.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run nonparametric bootstrapping</span>
<span class="va">np_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu">trait_np_bootstrap</span><span class="op">(</span>
  <span class="va">trait_imputation</span>, 
  nrep <span class="op">=</span> <span class="fl">200</span>
  <span class="op">)</span>
<span class="va">np_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 × 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.62    1.94         2.64     8.79 </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0126  0.0000684    1.22     2.42 </span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.67    2.48         2.50     7.04 </span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0134  0.0000688    1.11     1.55 </span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.69    1.40         2.62     8.84 </span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0151  0.000183     5.82    50.0  </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 1.75    4.30         2.52     6.04 </span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0112  0.0000392    2.94    20.6  </span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 7.20   18.0          0.153   -0.703</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0170  0.000317     2.55     5.47 </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code></pre></div>
<p>One advantage of using a bootstrapping approach, is that we get much more than a mean trait value.
We can also estimate the variance and other moments of these trait distributions.
In traitstrap happy moments can be summarized and the confidence intervals calculated using the <code>trait_summarise_boot_moments</code> function.
The input variable for this function is the output from the nonparametric bootstrapping function (or the parametric bootstrapping function, see below).</p>
<p>The confidence interval can be calculated parametrically, using the mean and standard deviation, or nonparametrically using quantiles.
The default is using the mean and standard deviation (<code>parametric = TRUE</code>) with one standard deviation around each trait moment (<code>sd_mult = 1</code>).
For the nonparametric approach the default is a 0.95 confidence level.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarizes bootstrapping output</span>
<span class="va">sum_boot_moment</span> <span class="op">&lt;-</span> <span class="fu">trait_summarise_boot_moments</span><span class="op">(</span>
  <span class="va">np_bootstrapped_moments</span>
  <span class="op">)</span>
<span class="va">sum_boot_moment</span>
<span class="co">#&gt; # A tibble: 28 × 17</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    global Site  PlotID Trait           n   mean ci_low_mean ci_high_mean     var</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plant_Heig…   200 1.72        1.60         1.83   2.60e+0</span>
<span class="co">#&gt;  2 global 1     A      Wet_Mass_g    200 0.0120      0.0114       0.0126 6.49e-5</span>
<span class="co">#&gt;  3 global 1     B      Plant_Heig…   200 1.74        1.63         1.85   2.57e+0</span>
<span class="co">#&gt;  4 global 1     B      Wet_Mass_g    200 0.0137      0.0131       0.0142 6.96e-5</span>
<span class="co">#&gt;  5 global 1     C      Plant_Heig…   200 1.72        1.63         1.82   1.88e+0</span>
<span class="co">#&gt;  6 global 1     C      Wet_Mass_g    200 0.0149      0.0142       0.0157 1.27e-4</span>
<span class="co">#&gt;  7 global 1     D      Plant_Heig…   200 1.85        1.72         1.98   4.51e+0</span>
<span class="co">#&gt;  8 global 1     D      Wet_Mass_g    200 0.0118      0.0113       0.0123 4.87e-5</span>
<span class="co">#&gt;  9 global 1     E      Plant_Heig…   200 7.06        6.79         7.33   1.71e+1</span>
<span class="co">#&gt; 10 global 1     E      Wet_Mass_g    200 0.0161      0.0150       0.0172 2.75e-4</span>
<span class="co">#&gt; # … with 18 more rows, and 8 more variables: ci_low_var &lt;dbl&gt;,</span>
<span class="co">#&gt; #   ci_high_var &lt;dbl&gt;, skew &lt;dbl&gt;, ci_low_skew &lt;dbl&gt;, ci_high_skew &lt;dbl&gt;,</span>
<span class="co">#&gt; #   kurt &lt;dbl&gt;, ci_low_kurt &lt;dbl&gt;, ci_high_kurt &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="parametric-bootstrapping" class="section level3" number="5.4.6">
<h3>
<span class="header-section-number">5.4.6</span> Parametric bootstrapping<a class="anchor" aria-label="anchor" href="#parametric-bootstrapping"><i class="fas fa-link"></i></a>
</h3>
<p>Traitstrap also offers the option to run a <strong>parametric bootstrapping</strong>.</p>
<p>The <code>trait_fit_distributions</code> function fits parametric distributions for each species-by-trait combination at the finest scale of the user-supplied hierarchy.
This function takes as input:</p>
<ul>
<li>an object of class imputed traits (as produced by the function <code>trait_impute</code>), and</li>
<li>the type of distribution to be fitted.</li>
</ul>
<p>Either a single distribution type can be used for all traits, or traits can be assigned specific distributions types by supplying the function with a named list of traits (e.g. <code>list(height = "normal", mass = "lognormal")</code>).</p>
<p>Currently the function supports normal, log-normal, and beta (values between 0 and 1) distributions.</p>
<p>The function returns a dataframe containing fitted distribution parameters.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu">trait_fit_distributions</span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="st">"lognormal"</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning in .data[["Trait"]] == names(distribution_type)[distribution_type == :</span>
<span class="co">#&gt; longer object length is not a multiple of shorter object length</span>
<span class="va">fitted_distributions</span>
<span class="co">#&gt; # A tibble: 202 × 15</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait, Taxon, Cover, n_sample [202]</span>
<span class="co">#&gt;    global Site  PlotID Trait  Taxon Cover n_sample distribution_ty…  parm1 parm2</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plant… bist…  10         28 lognormal         0.328 0.517</span>
<span class="co">#&gt;  2 global 1     A      Plant… drya…   0.1        9 lognormal         1.04  0.704</span>
<span class="co">#&gt;  3 global 1     A      Plant… fest…   1         11 lognormal         1.61  0.377</span>
<span class="co">#&gt;  4 global 1     A      Plant… luzu…   0.5       15 lognormal         1.50  0.325</span>
<span class="co">#&gt;  5 global 1     A      Plant… luzu…   1         20 lognormal         0.588 0.459</span>
<span class="co">#&gt;  6 global 1     A      Plant… sali…  20         44 lognormal        -0.138 0.931</span>
<span class="co">#&gt;  7 global 1     A      Plant… saxi…   2          6 lognormal         1.13  0.469</span>
<span class="co">#&gt;  8 global 1     A      Plant… saxi…   2          2 lognormal         0.693 0    </span>
<span class="co">#&gt;  9 global 1     A      Plant… sile…   1          3 lognormal        -0.221 0.277</span>
<span class="co">#&gt; 10 global 1     A      Wet_M… bist…  10         29 lognormal        -4.06  0.454</span>
<span class="co">#&gt; # … with 192 more rows, and 5 more variables: sd1 &lt;lgl&gt;, sd2 &lt;lgl&gt;, ks &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cvm &lt;dbl&gt;, ad &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit several types of distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu">trait_fit_distributions</span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Plant_Height_cm <span class="op">=</span> <span class="st">"normal"</span>, Wet_Mass_g <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">fitted_distributions</span></code></pre></div>
<p>The <code>trait_parametric_bootstrap</code> function is a parametric analogue of the <code>trait_np_bootstrap</code> function.
It takes in fitted trait distributions produced by <code>trait_fit_distributions</code> and randomly samples from among the fitted distributions proportionally to species abundances in the community.</p>
<p>As with <code>trait_np_bootstrap</code>, the number of samples per replicated draw are specified with the parameter <code>sample_size</code>, and the number of replicated draws is specified by the parameter <code>nrep.</code>
The argument <code>raw</code> allows to extract raw distributions (see above).</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run parametric bootstrapping</span>
<span class="va">p_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu">trait_parametric_bootstrap</span><span class="op">(</span>
    fitted_distributions <span class="op">=</span> <span class="va">fitted_distributions</span>, 
    nrep <span class="op">=</span> <span class="fl">200</span>
    <span class="op">)</span>
<span class="va">p_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 × 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.77    2.36         1.65     2.49 </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0124  0.0000659    1.68     3.61 </span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.80    2.26         1.33     1.21 </span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0141  0.0000655    1.81     5.62 </span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.81    1.92         2.09     4.04 </span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0140  0.000114     4.93    39.6  </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 1.91    6.34         3.23    13.2  </span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0119  0.0000569    3.71    25.7  </span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 7.01   15.2          0.177   -0.128</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0176  0.000223     1.97     4.03 </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code></pre></div>
<p>The output of trait_parametric_bootstrap can be summarized using <code>trait_summarize_boot_moments</code> (see above).</p>
</div>
<div id="extracting-raw-distributions" class="section level3" number="5.4.7">
<h3>
<span class="header-section-number">5.4.7</span> Extracting raw distributions<a class="anchor" aria-label="anchor" href="#extracting-raw-distributions"><i class="fas fa-link"></i></a>
</h3>
<p>In traitstrap both the parametric and nonparametric bootstrapping functions allow returning raw trait distributions.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run nonparametric bootstrapping</span>
<span class="va">raw_dist_np</span> <span class="op">&lt;-</span> <span class="fu">trait_np_bootstrap</span><span class="op">(</span>
  <span class="va">trait_imputation</span>,
  raw <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="va">raw_dist_np</span>
<span class="co">#&gt; # A tibble: 5,600 × 13</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     Taxon    Cover Site  PlotID global sum_abun Trait Value n_sample weight</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     salix p…    20 1     A      global     38.2 Plan…   2         44  0.455</span>
<span class="co">#&gt;  2 1     salix p…    20 1     A      global     38.2 Plan…   0.8       44  0.455</span>
<span class="co">#&gt;  3 1     bistort…    10 1     A      global     38.2 Plan…   1.1       28  0.357</span>
<span class="co">#&gt;  4 1     salix p…    20 1     A      global     38.2 Plan…   1.5       44  0.455</span>
<span class="co">#&gt;  5 1     salix p…    20 1     A      global     38.2 Plan…   1.1       44  0.455</span>
<span class="co">#&gt;  6 1     bistort…    10 1     A      global     38.2 Plan…   0.8       28  0.357</span>
<span class="co">#&gt;  7 1     salix p…    20 1     A      global     38.2 Plan…   1.1       44  0.455</span>
<span class="co">#&gt;  8 1     salix p…    20 1     A      global     38.2 Plan…   1         44  0.455</span>
<span class="co">#&gt;  9 1     salix p…    20 1     A      global     38.2 Plan…   1.6       44  0.455</span>
<span class="co">#&gt; 10 1     luzula …     1 1     A      global     38.2 Plan…   1.5       20  0.05 </span>
<span class="co">#&gt; # … with 5,590 more rows, and 2 more variables: level &lt;ord&gt;,</span>
<span class="co">#&gt; #   max_n_in_sample &lt;int&gt;</span></code></pre></div>
<p>The raw data can be useful for visualizing the trait distributions.</p>
<p>Use colour and facets to separate between the different traits, hierarchies and treatments.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">raw_dist_np</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">Site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>end <span class="op">=</span> <span class="fl">0.9</span>, option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log(trait value)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="5-4_bootstrapping_files/figure-html/plot-raw-dist-np-1.png" width="576"></div>
</div>
<div id="check-your-data" class="section level3" number="5.4.8">
<h3>
<span class="header-section-number">5.4.8</span> Check your data<a class="anchor" aria-label="anchor" href="#check-your-data"><i class="fas fa-link"></i></a>
</h3>
<p>Traitstrap has a couple of functions to check the data.</p>
<p>The <code>coverage_plot</code> function shows the trait coverage of the community for each level.
Basically, this function summarizes from which level the traits are imputed, and how much coverage of the community is reached.</p>
<p>Based on simulations, we recommend to collect traits for at least 80% of the community cover (Maitner et al. in prep).</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># show coverage plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">trait_imputation</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="5-4_bootstrapping_files/figure-html/coverage-plot-1.png" width="576"></div>
<p>Another important information is to know of which taxa traits are missing.
This can be useful if the data sampling is not finished and you want to know which species should be sampled.
The function also tells you the maximal abundance of each missing species, and gives you useful information if the missing species are abundant or rare.</p>
<p>Traitstrap has a function <code>trait_missing</code> which gives you a table with all missing values.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># list missing traits</span>
<span class="fu">trait_missing</span><span class="op">(</span>imputed_trait <span class="op">=</span> <span class="va">trait_imputation</span>,
              comm <span class="op">=</span> <span class="va">community</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 × 3</span>
<span class="co">#&gt; # Groups:   Taxon [20]</span>
<span class="co">#&gt;    Taxon                      max_abun n_traits</span>
<span class="co">#&gt;    &lt;chr&gt;                         &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1 alopecurus ovatus               2          2</span>
<span class="co">#&gt;  2 bistorta vigdis                25          2</span>
<span class="co">#&gt;  3 calamagrostis neglecta         60          2</span>
<span class="co">#&gt;  4 cassiope tetragona              5          2</span>
<span class="co">#&gt;  5 dryas octopetala               20          2</span>
<span class="co">#&gt;  6 enquistetum scirpoides          2          2</span>
<span class="co">#&gt;  7 festuca rubra                   1          2</span>
<span class="co">#&gt;  8 juncus biglumis                 0.5        1</span>
<span class="co">#&gt;  9 luzula confusa                  5          2</span>
<span class="co">#&gt; 10 luzula nivalis                  5          2</span>
<span class="co">#&gt; 11 maitneranthes hieracifolia      0.5        1</span>
<span class="co">#&gt; 12 oxyria tanyna                   2          2</span>
<span class="co">#&gt; 13 poa pratensis                   1          2</span>
<span class="co">#&gt; 14 salix polaris                  43          2</span>
<span class="co">#&gt; 15 saxifraga hirculus              2          2</span>
<span class="co">#&gt; 16 saxifraga oppositifolia         2          2</span>
<span class="co">#&gt; 17 silene acaudis                  1          2</span>
<span class="co">#&gt; 18 stelfordaria humifusa           0.5        1</span>
<span class="co">#&gt; 19 stellaria longipes              0.1        1</span>
<span class="co">#&gt; 20 trisetum spicatum               3          2</span></code></pre></div>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Perez-Harguindeguy2013-nv" class="csl-entry">
Pérez-Harguindeguy, N, S Dı́az, E Garnier, S Lavorel, H Poorter, P Jaureguiberry, M S Bret-Harte, et al. 2013. <span>“New Handbook for Standardised Measurement of Plant Functional Traits Worldwide.”</span> <em>Australian Journal of Botany</em>.
</div>
<div id="ref-Vandvik2020-hu" class="csl-entry">
Vandvik, Vigdis, Olav Skarpaas, Kari Klanderud, Richard J Telford, Aud H Halbritter, and Deborah E Goldberg. 2020. <span>“Biotic Rescaling Reveals Importance of Species Interactions for Variation in Biodiversity Responses to Climate Change.”</span> <em>Proc. Natl. Acad. Sci. U. S. A.</em> 117 (37): 22858–65.
</div>
<div id="ref-Yang2018-uq" class="csl-entry">
Yang, Yan, Aud Helen Halbritter, Kari Klanderud, Richard J Telford, Genxu Wang, and Vigdis Vandvik. 2018. <span>“Transplants, Open Top Chambers (<span>OTCs</span>) and Gradient Studies Ask Different Questions in Climate Change Effects Studies.”</span> <em>Front. Plant Sci.</em> 9: 1574.
</div>
</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="working-with-pftc-data.html"><span class="header-section-number">4</span> Working with PFTC data</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-curation-and-analysis"><span class="header-section-number">5</span> Data curation and analysis</a></li>
<li><a class="nav-link" href="#introduction-to-rrstudio-data-analysis-and-more"><span class="header-section-number">5.1</span> Introduction to R/RStudio, data analysis and more</a></li>
<li>
<a class="nav-link" href="#data-curation"><span class="header-section-number">5.2</span> Data curation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#useful-packages"><span class="header-section-number">5.2.1</span> Useful packages</a></li>
<li><a class="nav-link" href="#import-data"><span class="header-section-number">5.2.2</span> Import data</a></li>
<li><a class="nav-link" href="#first-check-of-the-dataset"><span class="header-section-number">5.2.3</span> First check of the dataset</a></li>
<li><a class="nav-link" href="#check-the-data-type"><span class="header-section-number">5.2.4</span> Check the data type</a></li>
<li><a class="nav-link" href="#exercise-1">Exercise</a></li>
<li><a class="nav-link" href="#check-for-duplicates"><span class="header-section-number">5.2.5</span> Check for duplicates</a></li>
<li><a class="nav-link" href="#check-for-missing-data"><span class="header-section-number">5.2.6</span> Check for missing data</a></li>
<li><a class="nav-link" href="#check-values-within-variables"><span class="header-section-number">5.2.7</span> Check values within variables</a></li>
<li><a class="nav-link" href="#visualise-data"><span class="header-section-number">5.2.8</span> Visualise data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#plant-community-composition-data"><span class="header-section-number">5.3</span> Plant community composition data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#diversity-indices"><span class="header-section-number">5.3.1</span> Diversity indices</a></li>
<li><a class="nav-link" href="#multivariate-analysis---nmds-ordination"><span class="header-section-number">5.3.2</span> Multivariate analysis - NMDS ordination</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#bootstrapping-method"><span class="header-section-number">5.4</span> Bootstrapping method</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-aim-of-traitstrap"><span class="header-section-number">5.4.1</span> The aim of traitstrap</a></li>
<li><a class="nav-link" href="#the-data"><span class="header-section-number">5.4.2</span> The data</a></li>
<li><a class="nav-link" href="#organize-your-data"><span class="header-section-number">5.4.3</span> Organize your data</a></li>
<li><a class="nav-link" href="#trait-imputation"><span class="header-section-number">5.4.4</span> Trait imputation</a></li>
<li><a class="nav-link" href="#nonparametric-bootstrapping"><span class="header-section-number">5.4.5</span> Nonparametric bootstrapping</a></li>
<li><a class="nav-link" href="#parametric-bootstrapping"><span class="header-section-number">5.4.6</span> Parametric bootstrapping</a></li>
<li><a class="nav-link" href="#extracting-raw-distributions"><span class="header-section-number">5.4.7</span> Extracting raw distributions</a></li>
<li><a class="nav-link" href="#check-your-data"><span class="header-section-number">5.4.8</span> Check your data</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>PFTC Teaching Material</strong>" was written by Aud Halbritter. It was last built on 2022-05-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.592">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>PFTC Teaching Material - 11&nbsp; Bootstrapping trait data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10_community.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="css/style-chapters.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Bootstrapping trait data</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PFTC Teaching Material</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_teaching_material/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">PFTC courses</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_courses.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">PFTC Course information</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">The study system</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_study_system.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Alpine ecosystems</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_three_d.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Three-D project</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_incline.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">INCLINE project</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Trait data collection</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_trait_collection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The trait wheel</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">PFTC data</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_pftc_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Working with PFTC data</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Data science</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_biostats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to R, RStudio and GitHub</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8_reproducible.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9_data_curation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data curation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_community.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Plant community composition data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_bootstrap.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Bootstrapping trait data</span></a>
  </div>
</li>
    </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#the-aim-of-traitstrap" id="toc-the-aim-of-traitstrap" class="nav-link active" data-scroll-target="#the-aim-of-traitstrap"> <span class="header-section-number">11.1</span> The aim of traitstrap</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data"> <span class="header-section-number">11.2</span> The data</a></li>
  <li><a href="#organize-your-data" id="toc-organize-your-data" class="nav-link" data-scroll-target="#organize-your-data"> <span class="header-section-number">11.3</span> Organize your data</a></li>
  <li><a href="#trait-imputation" id="toc-trait-imputation" class="nav-link" data-scroll-target="#trait-imputation"> <span class="header-section-number">11.4</span> Trait imputation</a></li>
  <li><a href="#nonparametric-bootstrapping" id="toc-nonparametric-bootstrapping" class="nav-link" data-scroll-target="#nonparametric-bootstrapping"> <span class="header-section-number">11.5</span> Nonparametric bootstrapping</a></li>
  <li><a href="#parametric-bootstrapping" id="toc-parametric-bootstrapping" class="nav-link" data-scroll-target="#parametric-bootstrapping"> <span class="header-section-number">11.6</span> Parametric bootstrapping</a></li>
  <li><a href="#extracting-raw-distributions" id="toc-extracting-raw-distributions" class="nav-link" data-scroll-target="#extracting-raw-distributions"> <span class="header-section-number">11.7</span> Extracting raw distributions</a></li>
  <li><a href="#check-your-data" id="toc-check-your-data" class="nav-link" data-scroll-target="#check-your-data"> <span class="header-section-number">11.8</span> Check your data</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Plant-Functional-Trait-Course/PFTC_teaching_material/blob/main/11_bootstrap.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">
<span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Bootstrapping trait data</span>
</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><!-- fig.align = 'right',  --><div class="cell">
<div class="cell-output-display">
<div id="fig-hex" class="quarto-figure quarto-figure-center anchored" style="float:right; padding:8px">
<figure class="figure"><p><img src="images/resources/Traitstrap_hex.png" class="img-fluid figure-img" alt="Traitstarp hex" style="width:15.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 11.1: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>This vignette explains how to use the traitstrap package (Telford et al). For more details on the methods see Maitner et al.</p>
<p>First of all, relax and turn on some music. We have prepared the <a href="https://tinyurl.com/traitstrap">traitstrap playlist</a> for you!</p>
<section id="the-aim-of-traitstrap" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="the-aim-of-traitstrap">
<span class="header-section-number">11.1</span> The aim of traitstrap</h2>
<p>Trait distributions can be used to infer the importance of community assembly processes and the role of climate drivers in shaping species and community responses to climate change. Community ecology has typically focused on the <strong>mean</strong>, however the <strong>higher moments</strong> (variance, skewness, and kurtosis) of trait distributions can reveal information about the various processes shaping species diversity.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/resources/true-dist.png" class="img-fluid figure-img" alt="True distribution, mean and higher moments." width="623"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">True distribution, mean and higher moments.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Measuring trait distributions is often difficult and time-consuming as it requires information on measuring trait values of all individuals present. Sampling protocols often limit sampling to a non-representative subset of the community, or rely upon species-level average traits values calculated in other locations or across many locations.</p>
<p>Traditionally the moments of trait distributions have been estimated using weighting approaches that rely on the average traits of species weighted by some measure of abundance within the community. Such <strong>community-weighted</strong> trait moments methods assume that a species’ trait expression can be adequately represented by the mean, ignoring intraspecific trait variation.</p>
<p>To more accurately estimate local trait distributions, trait sampling should thus occur both across multiple individuals within each species, and across multiple locations or experimental treatments across the extent of the study in order to capture both inter- and intra-specific variability.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/resources/comm-boot.png" class="img-fluid figure-img" alt="Community weighted mean versus bootstrapping method." width="622"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Community weighted mean versus bootstrapping method.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>Traitstrap</strong> is an <strong>R package</strong> to estimate the moments of community trait distributions using a <strong>bootstrapping approach</strong>. Further, this package uses a hierarchical sampling design, which allows accounting for incomplete trait collections, traits from different spatial or temporal levels (e.g.&nbsp;local traits vs.&nbsp;databases), taxonomic hierarchies (e.g., species vs genus) and experimental designs (e.g., multiple sites, or treated vs.&nbsp;control sampling units).</p>
<p>The package has three <strong>main functions</strong>:</p>
<ul>
<li>
<strong>trait imputation</strong> function which allows to account for intraspecific trait variation and hierarchical sampling design.</li>
<li>a resample method using <strong>bootstrapping</strong> (parametric or nonparametric method) to calculate community weighted mean and happy moments (variance, skewness and kurtosis).</li>
<li>a <strong>summary function</strong> that summarizes the trait moments and calculates confidence intervals.</li>
</ul>
<p>Note that for this tutorial we are calling the mean and the higher moments the happy moments :-)</p>
</section><section id="the-data" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="the-data">
<span class="header-section-number">11.2</span> The data</h2>
<p>For this vignette we will use part of a vascular plant dataset from two sites near Longyearbyen on Svalbard. The data was collected during the Plant Functional Trait Course in 2018 and contains data on the plant community composition and functional traits. For more details see this <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_4_Svalbard">GitHub repo</a></p>
<p>Note that some of the species names have been adapted.</p>
<div class="cell">

</div>
</section><section id="organize-your-data" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="organize-your-data">
<span class="header-section-number">11.3</span> Organize your data</h2>
<p>To run traitstrap two datasets are required:</p>
<ul>
<li>one dataset with information on abundance (e.g.&nbsp;biomass, size, cover, etc.) of the community, which is used to weight species traits by abundance in the community.</li>
<li>one dataset with the traits for each species (or as many species and individuals you have data for) in your community.</li>
</ul>
<p>The datasets need to be organized in a <strong>tidy</strong> and <strong>long</strong> format and certain columns (see below) are required, but the naming of these columns are up to the user.</p>
<p>Let us have a look at these datasets in an example.</p>
<p>The <strong>community data</strong> should have information the abundance of species in the community. This dataset will be used to weigh the traits by species abundance. Note that abundance can also be cover, size, biomass, or something similar.</p>
<p>In this example the contains species names (e.g.&nbsp;<strong>Taxon</strong>), cover of each species per plot (e.g.&nbsp;<strong>Cover</strong>) and two columns with information about the <strong>hierarchy</strong> (i.e.&nbsp;<strong>Site</strong> and <strong>PlotID</strong>).</p>
<div class="cell">
<pre><code>#&gt; # A tibble: 110 × 4
#&gt;    Taxon             Cover Site  PlotID
#&gt;    &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
#&gt;  1 alopecurus ovatus   0.5 1     B     
#&gt;  2 alopecurus ovatus   1   1     C     
#&gt;  3 alopecurus ovatus   1   1     D     
#&gt;  4 alopecurus ovatus   2   1     F     
#&gt;  5 alopecurus ovatus   0.1 1     G     
#&gt;  6 bistorta vigdis    10   1     A     
#&gt;  7 bistorta vigdis    25   1     B     
#&gt;  8 bistorta vigdis    10   1     C     
#&gt;  9 bistorta vigdis     2   1     D     
#&gt; 10 bistorta vigdis     1   1     F     
#&gt; # … with 100 more rows</code></pre>
</div>
<p>The <strong>trait data</strong> should contain information about traits and trait values for as many species and individuals in the community data as possible. The data should be organized in the same way as the community data and should have corresponding columns. In this example the trait data contains <strong>Taxon</strong>, <strong>Site</strong> and <strong>PlotID</strong> as well as <strong>Trait</strong> and <strong>Value</strong>.</p>
<div class="cell">
<pre><code>#&gt; # A tibble: 749 × 5
#&gt;    Taxon                   Site  PlotID Trait         Value
#&gt;    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;
#&gt;  1 saxifraga oppositifolia 1     A      Wet_Mass_g 0.000695
#&gt;  2 bistorta vigdis         1     C      Wet_Mass_g 0.0105  
#&gt;  3 festuca rubra           2     C      Wet_Mass_g 0.00724 
#&gt;  4 bistorta vigdis         1     C      Wet_Mass_g 0.0189  
#&gt;  5 equisetum arvense       1     E      Wet_Mass_g 0.270   
#&gt;  6 bistorta vigdis         1     B      Wet_Mass_g 0.0231  
#&gt;  7 luzula confusa          1     F      Wet_Mass_g 0.0135  
#&gt;  8 alopecurus ovatus       1     G      Wet_Mass_g 0.0234  
#&gt;  9 alopecurus ovatus       1     G      Wet_Mass_g 0.0300  
#&gt; 10 alopecurus ovatus       1     C      Wet_Mass_g 0.0267  
#&gt; # … with 739 more rows</code></pre>
</div>
</section><section id="trait-imputation" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="trait-imputation">
<span class="header-section-number">11.4</span> Trait imputation</h2>
<p>The <code>trait_impute</code> function uses a hierarchical sampling design, which allows to account for incomplete trait collections, traits from different spatial or temporal levels (i.e.&nbsp;local traits vs.&nbsp;databases), different taxonomic resolution and/or experimental design.</p>
<p>The first two mandatory arguments in the function are the two datasets: <code>comm</code> and <code>traits</code></p>
<p>The next four arguments are also mandatory and refer to specific columns in the trait or community dataset:</p>
<ul>
<li>
<code>abundance</code> which is the abundance of your species in your community dataset. This can be abundance, cover, biomass, or size, etc.</li>
<li>
<code>taxon_col</code> is the column in your community and trait data that define the species.</li>
<li>
<code>trait_col</code> is the column in your trait data that defines the traits.</li>
<li>
<code>value_col</code> is the column in your trait data that defines the trait values.</li>
</ul>
<p>All the other arguments are not mandatory.</p>
<p>With <code>scale_hierarchy</code> you can define the levels at which the traits have been collected and the order of trait imputation starting with the highest level (e.g.&nbsp;global database, regional, site, plot). In the example below we have the levels <strong>Site</strong> and <strong>PlotID</strong>, starting with the highest level.</p>
<p>The <code>trait_impute</code> function will choose if available a trait value from the lowest level, i.e.&nbsp;species X from plot A in site 1. If no trait value is available from that level (plot A, site 1), it will other groups in the same level and choose a trait value from species X from plot B or C at site 1. If there is no trait available, it will move up the hierarchy to the next level and choose trait values from species X from other sites (site 2, 3, etc.).</p>
<p>The argument <code>min_n_in_samples</code> allows users to define the minimum number in samples that are chosen at each level. If the minimum number is not reached (i.e.&nbsp;there are only 3 trait values at a specific level), trait values from the next higher level will be imputed, to avoid sampling the same individual several times, which could result in unrealistic variances. The default minimum number of samples is 5.</p>
<p>In the <code>other_col</code> argument other grouping variables in the community dataset can be defined and will be kept after the trait imputation.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">trait_imputation</span> <span class="op">&lt;-</span> <span class="fu">trait_impute</span><span class="op">(</span>
    <span class="co"># input data (mandatory)</span>
    comm <span class="op">=</span> <span class="va">community</span>,
    traits <span class="op">=</span> <span class="va">trait</span>,
    
    <span class="co"># specifies columns in your data (mandatory)</span>
    abundance_col <span class="op">=</span> <span class="st">"Cover"</span>,
    taxon_col <span class="op">=</span> <span class="st">"Taxon"</span>,
    trait_col <span class="op">=</span> <span class="st">"Trait"</span>,
    value_col <span class="op">=</span> <span class="st">"Value"</span>,
    
    <span class="co"># specifies sampling hierarchy</span>
    scale_hierarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site"</span>, <span class="st">"PlotID"</span><span class="op">)</span>,
    
    <span class="co"># min number of samples</span>
    min_n_in_sample <span class="op">=</span> <span class="fl">9</span>
  <span class="op">)</span>
<span class="va">trait_imputation</span>
<span class="co">#&gt; # A tibble: 4,007 × 12</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    Taxon  Cover Site  PlotID global sum_abun Trait   Value n_sample weight level</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;ord&gt;</span>
<span class="co">#&gt;  1 festu…     1 1     A      global     38.2 Wet_… 0.00724       11 0.0909 glob…</span>
<span class="co">#&gt;  2 festu…     1 1     A      global     38.2 Wet_… 0.0160        11 0.0909 glob…</span>
<span class="co">#&gt;  3 festu…     1 1     A      global     38.2 Wet_… 0.00529       11 0.0909 glob…</span>
<span class="co">#&gt;  4 festu…     1 1     A      global     38.2 Wet_… 0.0154        11 0.0909 glob…</span>
<span class="co">#&gt;  5 festu…     1 1     A      global     38.2 Wet_… 0.0066        11 0.0909 glob…</span>
<span class="co">#&gt;  6 festu…     1 1     A      global     38.2 Wet_… 0.00637       11 0.0909 glob…</span>
<span class="co">#&gt;  7 festu…     1 1     A      global     38.2 Wet_… 0.00491       11 0.0909 glob…</span>
<span class="co">#&gt;  8 festu…     1 1     A      global     38.2 Wet_… 0.0132        11 0.0909 glob…</span>
<span class="co">#&gt;  9 festu…     1 1     A      global     38.2 Wet_… 0.0233        11 0.0909 glob…</span>
<span class="co">#&gt; 10 festu…     1 1     A      global     38.2 Wet_… 0.0115        11 0.0909 glob…</span>
<span class="co">#&gt; # … with 3,997 more rows, and 1 more variable: max_n_in_sample &lt;int&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Traitstrap also allows to include taxonomy and experimental design in the trait imputation step.</p>
<p>With the argument <code>taxon_col</code> the taxonomic hierarchy for sampling can be defined. This means if traits for a specific species are not available, trait values from the same genus will be imputed. For this a list of the taxonomic hierarchy has to be defined (e.g.&nbsp;“Taxon”, “Genus”). Note that traits from species of the same genus can have very different traits and it might not be meaningful to impute these traits. Therefore, you should always check the trait distributions for the same genus before using taxonomic trait imputation.</p>
<p>The argument <code>treatment_col</code> allows to incorporate an experimental design where traits are imputed from the same experimental treatment or the first factor level, which is assumed to be the control. Therefore, it is important to order the levels of a treatment in the right order, i.e.&nbsp;the first level has to be the control. The imputation step can be defined at certain level using the <code>treatment_level</code> argument. Depending on the experimental design it might make sense to impute traits at a certain level, e.g.&nbsp;block or site.</p>
<p>Here is an example how to include taxonomy and experimental design in the trait imputation function (code not run).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>trait_imputation2 <span class="ot">&lt;-</span> <span class="fu">trait_impute</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">comm =</span> community,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> trait,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_col =</span> <span class="st">"Cover"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># defining taxonomic hierarchy</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon_col =</span> <span class="fu">c</span>(<span class="st">"Taxon"</span>, <span class="st">"Genus"</span>),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trait_col =</span> <span class="st">"Trait"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_col =</span> <span class="st">"Value"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale_hierarchy =</span> <span class="fu">c</span>(<span class="st">"Site"</span>, <span class="st">"PlotID"</span>),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_n_in_sample =</span> <span class="dv">3</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specifying experimental design</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_col =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_level =</span> <span class="st">"Site"</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="nonparametric-bootstrapping" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="nonparametric-bootstrapping">
<span class="header-section-number">11.5</span> Nonparametric bootstrapping</h2>
<p>The output of the trait imputation function is then used to do a <strong>nonparametric bootstrapping</strong> using the <code>trait_np_bootstrap</code> function.</p>
<p>Nonparametric bootstrapping is a resampling method to estimate the trait moments. The traits are re-sampled in proportion to their weight in the community (e.g.&nbsp;by the abundance of the species).</p>
<p>The trait values across all individuals in a community are resampled n times (<code>sample_size</code>; the default is 200) to incorporate the full spectrum of trait variation, generating n number (<code>nrep</code>; the default is 100) of trait distributions.</p>
<p>From these trait distributions the happy moments are estimated: <strong>mean</strong>, <strong>variance</strong>, <strong>skewness</strong> and <strong>kurtosis</strong>.</p>
<p>This function also allows to extract raw distributions by setting the argument <code>raw = TRUE</code>. The raw data can be useful for visualizing the trait distributions. If the raw data is extracted, <code>nrep</code> is forced to 1 to avoid memory issues.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># run nonparametric bootstrapping</span>
<span class="va">np_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu">trait_np_bootstrap</span><span class="op">(</span>
  <span class="va">trait_imputation</span>, 
  nrep <span class="op">=</span> <span class="fl">200</span>
  <span class="op">)</span>
<span class="va">np_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 × 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.64    2.18         3.40    14.7  </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0125  0.0000669    0.975    1.28 </span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.89    2.85         2.12     4.72 </span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0136  0.0000543    1.17     2.26 </span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.62    1.61         2.57     7.49 </span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0150  0.000138     5.76    49.6  </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 1.73    3.33         2.79     8.02 </span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0121  0.0000592    2.72    12.8  </span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 6.83   15.8          0.305   -0.417</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0157  0.000269     2.84     7.47 </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One advantage of using a bootstrapping approach, is that we get much more than a mean trait value. We can also estimate the variance and other moments of these trait distributions. In traitstrap happy moments can be summarized and the confidence intervals calculated using the <code>trait_summarise_boot_moments</code> function. The input variable for this function is the output from the nonparametric bootstrapping function (or the parametric bootstrapping function, see below).</p>
<p>The confidence interval can be calculated parametrically, using the mean and standard deviation, or nonparametrically using quantiles. The default is using the mean and standard deviation (<code>parametric = TRUE</code>) with one standard deviation around each trait moment (<code>sd_mult = 1</code>). For the nonparametric approach the default is a 0.95 confidence level.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># summarizes bootstrapping output</span>
<span class="va">sum_boot_moment</span> <span class="op">&lt;-</span> <span class="fu">trait_summarise_boot_moments</span><span class="op">(</span>
  <span class="va">np_bootstrapped_moments</span>
  <span class="op">)</span>
<span class="va">sum_boot_moment</span>
<span class="co">#&gt; # A tibble: 28 × 17</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    global Site  PlotID Trait           n   mean ci_low_mean ci_high_mean     var</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plant_Heig…   200 1.74        1.62         1.86   2.74e+0</span>
<span class="co">#&gt;  2 global 1     A      Wet_Mass_g    200 0.0121      0.0116       0.0126 6.54e-5</span>
<span class="co">#&gt;  3 global 1     B      Plant_Heig…   200 1.76        1.64         1.88   2.68e+0</span>
<span class="co">#&gt;  4 global 1     B      Wet_Mass_g    200 0.0136      0.0130       0.0142 6.84e-5</span>
<span class="co">#&gt;  5 global 1     C      Plant_Heig…   200 1.72        1.63         1.82   1.88e+0</span>
<span class="co">#&gt;  6 global 1     C      Wet_Mass_g    200 0.0149      0.0142       0.0156 1.33e-4</span>
<span class="co">#&gt;  7 global 1     D      Plant_Heig…   200 1.86        1.71         2.01   4.65e+0</span>
<span class="co">#&gt;  8 global 1     D      Wet_Mass_g    200 0.0117      0.0112       0.0122 5.06e-5</span>
<span class="co">#&gt;  9 global 1     E      Plant_Heig…   200 7.07        6.79         7.35   1.70e+1</span>
<span class="co">#&gt; 10 global 1     E      Wet_Mass_g    200 0.0160      0.0149       0.0170 2.69e-4</span>
<span class="co">#&gt; # … with 18 more rows, and 8 more variables: ci_low_var &lt;dbl&gt;,</span>
<span class="co">#&gt; #   ci_high_var &lt;dbl&gt;, skew &lt;dbl&gt;, ci_low_skew &lt;dbl&gt;, ci_high_skew &lt;dbl&gt;,</span>
<span class="co">#&gt; #   kurt &lt;dbl&gt;, ci_low_kurt &lt;dbl&gt;, ci_high_kurt &lt;dbl&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="parametric-bootstrapping" class="level2" data-number="11.6"><h2 data-number="11.6" class="anchored" data-anchor-id="parametric-bootstrapping">
<span class="header-section-number">11.6</span> Parametric bootstrapping</h2>
<p>Traitstrap also offers the option to run a <strong>parametric bootstrapping</strong>.</p>
<p>The <code>trait_fit_distributions</code> function fits parametric distributions for each species-by-trait combination at the finest scale of the user-supplied hierarchy. This function takes as input:</p>
<ul>
<li>an object of class imputed traits (as produced by the function <code>trait_impute</code>), and</li>
<li>the type of distribution to be fitted.</li>
</ul>
<p>Either a single distribution type can be used for all traits, or traits can be assigned specific distributions types by supplying the function with a named list of traits (e.g.&nbsp;<code>list(height = "normal", mass = "lognormal")</code>).</p>
<p>Currently the function supports normal, log-normal, and beta (values between 0 and 1) distributions.</p>
<p>The function returns a dataframe containing fitted distribution parameters.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># fit distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu">trait_fit_distributions</span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="st">"lognormal"</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning in .data[["Trait"]] == names(distribution_type)[distribution_type == :</span>
<span class="co">#&gt; longer object length is not a multiple of shorter object length</span>
<span class="va">fitted_distributions</span>
<span class="co">#&gt; # A tibble: 202 × 15</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait, Taxon, Cover, n_sample [202]</span>
<span class="co">#&gt;    global Site  PlotID Trait  Taxon Cover n_sample distribution_ty…  parm1 parm2</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plant… bist…  10         28 lognormal         0.328 0.517</span>
<span class="co">#&gt;  2 global 1     A      Plant… drya…   0.1        9 lognormal         1.04  0.704</span>
<span class="co">#&gt;  3 global 1     A      Plant… fest…   1         11 lognormal         1.61  0.377</span>
<span class="co">#&gt;  4 global 1     A      Plant… luzu…   0.5       15 lognormal         1.50  0.325</span>
<span class="co">#&gt;  5 global 1     A      Plant… luzu…   1         20 lognormal         0.588 0.459</span>
<span class="co">#&gt;  6 global 1     A      Plant… sali…  20         44 lognormal        -0.138 0.931</span>
<span class="co">#&gt;  7 global 1     A      Plant… saxi…   2          6 lognormal         1.13  0.469</span>
<span class="co">#&gt;  8 global 1     A      Plant… saxi…   2          2 lognormal         0.693 0    </span>
<span class="co">#&gt;  9 global 1     A      Plant… sile…   1          3 lognormal        -0.221 0.277</span>
<span class="co">#&gt; 10 global 1     A      Wet_M… bist…  10         29 lognormal        -4.06  0.454</span>
<span class="co">#&gt; # … with 192 more rows, and 5 more variables: sd1 &lt;lgl&gt;, sd2 &lt;lgl&gt;, ks &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cvm &lt;dbl&gt;, ad &lt;dbl&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># fit several types of distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu">trait_fit_distributions</span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Plant_Height_cm <span class="op">=</span> <span class="st">"normal"</span>, Wet_Mass_g <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">fitted_distributions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>trait_parametric_bootstrap</code> function is a parametric analogue of the <code>trait_np_bootstrap</code> function. It takes in fitted trait distributions produced by <code>trait_fit_distributions</code> and randomly samples from among the fitted distributions proportionally to species abundances in the community.</p>
<p>As with <code>trait_np_bootstrap</code>, the number of samples per replicated draw are specified with the parameter <code>sample_size</code>, and the number of replicated draws is specified by the parameter <code>nrep.</code> The argument <code>raw</code> allows to extract raw distributions (see above).</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># run parametric bootstrapping</span>
<span class="va">p_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu">trait_parametric_bootstrap</span><span class="op">(</span>
    fitted_distributions <span class="op">=</span> <span class="va">fitted_distributions</span>, 
    nrep <span class="op">=</span> <span class="fl">200</span>
    <span class="op">)</span>
<span class="va">p_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 × 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.62    1.66         1.78     4.59 </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0130  0.0000751    1.92     6.70 </span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.68    2.13         1.54     2.17 </span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0135  0.0000783    2.45     9.71 </span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.78    1.88         2.22     5.11 </span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0140  0.0000539    1.20     2.32 </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 1.65    3.01         1.94     3.60 </span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0120  0.000108     6.01    53.0  </span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 6.88   17.6          0.239   -0.169</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0164  0.000302     4.75    31.4  </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of trait_parametric_bootstrap can be summarized using <code>trait_summarize_boot_moments</code> (see above).</p>
</section><section id="extracting-raw-distributions" class="level2" data-number="11.7"><h2 data-number="11.7" class="anchored" data-anchor-id="extracting-raw-distributions">
<span class="header-section-number">11.7</span> Extracting raw distributions</h2>
<p>In traitstrap both the parametric and nonparametric bootstrapping functions allow returning raw trait distributions.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># run nonparametric bootstrapping</span>
<span class="va">raw_dist_np</span> <span class="op">&lt;-</span> <span class="fu">trait_np_bootstrap</span><span class="op">(</span>
  <span class="va">trait_imputation</span>,
  raw <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="va">raw_dist_np</span>
<span class="co">#&gt; # A tibble: 5,600 × 13</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     Taxon    Cover Site  PlotID global sum_abun Trait Value n_sample weight</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     salix p…    20 1     A      global     38.2 Plan…   0.3       44  0.455</span>
<span class="co">#&gt;  2 1     salix p…    20 1     A      global     38.2 Plan…   0.6       44  0.455</span>
<span class="co">#&gt;  3 1     luzula …     1 1     A      global     38.2 Plan…   1.6       20  0.05 </span>
<span class="co">#&gt;  4 1     saxifra…     2 1     A      global     38.2 Plan…   5          6  0.333</span>
<span class="co">#&gt;  5 1     bistort…    10 1     A      global     38.2 Plan…   2         28  0.357</span>
<span class="co">#&gt;  6 1     salix p…    20 1     A      global     38.2 Plan…   1         44  0.455</span>
<span class="co">#&gt;  7 1     saxifra…     2 1     A      global     38.2 Plan…   2          6  0.333</span>
<span class="co">#&gt;  8 1     salix p…    20 1     A      global     38.2 Plan…   1.4       44  0.455</span>
<span class="co">#&gt;  9 1     saxifra…     2 1     A      global     38.2 Plan…   5.6        6  0.333</span>
<span class="co">#&gt; 10 1     bistort…    10 1     A      global     38.2 Plan…   2.3       28  0.357</span>
<span class="co">#&gt; # … with 5,590 more rows, and 2 more variables: level &lt;ord&gt;,</span>
<span class="co">#&gt; #   max_n_in_sample &lt;int&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The raw data can be useful for visualizing the trait distributions.</p>
<p>Use colour and facets to separate between the different traits, hierarchies and treatments.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">raw_dist_np</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">Site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>end <span class="op">=</span> <span class="fl">0.9</span>, option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log(trait value)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11_bootstrap_files/figure-html/plot-raw-dist-np-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section><section id="check-your-data" class="level2" data-number="11.8"><h2 data-number="11.8" class="anchored" data-anchor-id="check-your-data">
<span class="header-section-number">11.8</span> Check your data</h2>
<p>Traitstrap has a couple of functions to check the data.</p>
<p>The <code>coverage_plot</code> function shows the trait coverage of the community for each level. Basically, this function summarizes from which level the traits are imputed, and how much coverage of the community is reached.</p>
<p>Based on simulations, we recommend to collect traits for at least 80% of the community cover (Maitner et al.&nbsp;in prep).</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># show coverage plot</span>
<span class="fu">autoplot</span><span class="op">(</span><span class="va">trait_imputation</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11_bootstrap_files/figure-html/coverage-plot-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Another important information is to know of which taxa traits are missing. This can be useful if the data sampling is not finished and you want to know which species should be sampled. The function also tells you the maximal abundance of each missing species, and gives you useful information if the missing species are abundant or rare.</p>
<p>Traitstrap has a function <code>trait_missing</code> which gives you a table with all missing values.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># list missing traits</span>
<span class="fu">trait_missing</span><span class="op">(</span>imputed_trait <span class="op">=</span> <span class="va">trait_imputation</span>,
              comm <span class="op">=</span> <span class="va">community</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 × 3</span>
<span class="co">#&gt; # Groups:   Taxon [20]</span>
<span class="co">#&gt;    Taxon                      max_abun n_traits</span>
<span class="co">#&gt;    &lt;chr&gt;                         &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1 alopecurus ovatus               2          2</span>
<span class="co">#&gt;  2 bistorta vigdis                25          2</span>
<span class="co">#&gt;  3 calamagrostis neglecta         60          2</span>
<span class="co">#&gt;  4 cassiope tetragona              5          2</span>
<span class="co">#&gt;  5 dryas octopetala               20          2</span>
<span class="co">#&gt;  6 enquistetum scirpoides          2          2</span>
<span class="co">#&gt;  7 festuca rubra                   1          2</span>
<span class="co">#&gt;  8 juncus biglumis                 0.5        1</span>
<span class="co">#&gt;  9 luzula confusa                  5          2</span>
<span class="co">#&gt; 10 luzula nivalis                  5          2</span>
<span class="co">#&gt; 11 maitneranthes hieracifolia      0.5        1</span>
<span class="co">#&gt; 12 oxyria tanyna                   2          2</span>
<span class="co">#&gt; 13 poa pratensis                   1          2</span>
<span class="co">#&gt; 14 salix polaris                  43          2</span>
<span class="co">#&gt; 15 saxifraga hirculus              2          2</span>
<span class="co">#&gt; 16 saxifraga oppositifolia         2          2</span>
<span class="co">#&gt; 17 silene acaudis                  1          2</span>
<span class="co">#&gt; 18 stelfordaria humifusa           0.5        1</span>
<span class="co">#&gt; 19 stellaria longipes              0.1        1</span>
<span class="co">#&gt; 20 trisetum spicatum               3          2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./10_community.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Plant community composition data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>
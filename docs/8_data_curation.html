<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.592">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>PFTC Teaching Material - 8&nbsp; Data curation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./9_community.html" rel="next">
<link href="./7_reproducible.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="css/style-chapters.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data curation</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PFTC Teaching Material</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_teaching_material/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">PFTC courses</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_courses.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">PFTC Course information</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">The study system</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_study_system.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Alpine ecosystems</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_three_d.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Three-D project</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Trait data collection</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_trait_collection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The trait wheel</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">PFTC data</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_pftc_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with PFTC data</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Data science</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_biostats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to R, RStudio and GitHub</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_reproducible.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8_data_curation.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data curation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9_community.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plant community composition data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_bootstrap.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bootstrapping method</span></a>
  </div>
</li>
    </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#useful-packages" id="toc-useful-packages" class="nav-link active" data-scroll-target="#useful-packages"> <span class="header-section-number">8.1</span> Useful packages</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data"> <span class="header-section-number">8.2</span> Import data</a></li>
  <li>
<a href="#first-check-of-the-dataset" id="toc-first-check-of-the-dataset" class="nav-link" data-scroll-target="#first-check-of-the-dataset"> <span class="header-section-number">8.3</span> First check of the dataset</a>
  <ul class="collapse">
<li><a href="#check-the-data-type" id="toc-check-the-data-type" class="nav-link" data-scroll-target="#check-the-data-type"> <span class="header-section-number">8.3.1</span> Check the data type</a></li>
  </ul>
</li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#check-for-duplicates" id="toc-check-for-duplicates" class="nav-link" data-scroll-target="#check-for-duplicates"> <span class="header-section-number">8.4</span> Check for duplicates</a></li>
  <li>
<a href="#check-for-missing-data" id="toc-check-for-missing-data" class="nav-link" data-scroll-target="#check-for-missing-data"> <span class="header-section-number">8.5</span> Check for missing data</a>
  <ul class="collapse">
<li><a href="#check-values-within-variables" id="toc-check-values-within-variables" class="nav-link" data-scroll-target="#check-values-within-variables"> <span class="header-section-number">8.5.1</span> Check values within variables</a></li>
  </ul>
</li>
  <li><a href="#visualise-data" id="toc-visualise-data" class="nav-link" data-scroll-target="#visualise-data"> <span class="header-section-number">8.6</span> Visualise data</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Plant-Functional-Trait-Course/PFTC_teaching_material/blob/main/8_data_curation.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">
<span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data curation</span>
</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><p>Data curation, transformation or cleaning is the first step after digitizing the data. Each dataset has to be checked for errors and corrected as best as possible. This tutorial shows how to check your dataset for errors and how to correct them.</p>
<p>For this tutorial we will be working with the trait dataset from Svalbard. See chapter <a href="5_pftc_data.html"><span>Chapter&nbsp;5</span></a> for how to access the data and information about the study, experiment and datasets.</p>
<section id="useful-packages" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="useful-packages">
<span class="header-section-number">8.1</span> Useful packages</h2>
<p>There are a couple of R packages that are useful for this work. First, <strong>tidyverse</strong> is a collection of R packages used for basic data manipulation and analysis.</p>
<p>If you have never used the packages you need to install it first using the function <code>install.packages("tidyverse")</code>. Otherwise, you can just load the packages.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Second, another useful package for data curation is <strong>tidylog</strong>, which is built on the <strong>dplyr</strong> and <strong>tidyr</strong> packages and provides useful information about the functions used.</p>
<p>Tidylog will for example tell you how many rows have been removed and are remaining when using the <code><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter()</a></code> function or how many rows match when using a join function. The information is always indicated in absolute numbers and percentage. The additional information is very useful to check if the right observations have been removed or manipulated, because mistakes are easily done.</p>
<p>Let’s install and/or load <strong>tidylog</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/elbersb/tidylog/">tidylog</a></span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note, that once <strong>tidylog</strong> is loaded it will automatically prioritize the tidylog function before the dplyr and tidyr functions. You actively have to choose if you do not want to use the tidylog version by using this notation: <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code>.</p>
</section><section id="import-data" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="import-data">
<span class="header-section-number">8.2</span> Import data</h2>
<p>The first step is to import the data to R. The data is stored as a <em>csv file</em> and we can use the function <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> to import that data. If your data has another format or importing data is new to, you have a look at this <a href="https://biostats-r.github.io/biostats/workingInR/importing-data-in-r.html">page</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/PFTC4_Svalbard_2018_Gradient_Traits.csv"</span><span class="op">)</span>
<span class="co">#&gt; Rows: 11345 Columns: 15</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr  (7): Project, Gradient, PlotID, ID, Functional_group, Taxon, Trait</span>
<span class="co">#&gt; dbl  (7): Year, Site, Individual_nr, Value, Elevation_m, Latitude_N, Longitu...</span>
<span class="co">#&gt; date (1): Date</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Give the dataset a name that indicates that this is the raw data.</p>
<p>The dataset contains measurements of 14 traits from two elevational gradients on Svalbard. The traits were measured on individual plants from 21 different graminoid and forb species. For more information about the sites, traits and measurements see <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_4_Svalbard">here</a>.</p>
<p><strong>Some manipulation</strong></p>
<p>Let us introduce some errors to the dataset.</p>
<p>The code to do this is hidden. But if you want to replicate the code to introduce errors you can find the code <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_teaching_material/R/manipulation.R">here</a>.</p>
<div class="cell">

</div>
</section><section id="first-check-of-the-dataset" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="first-check-of-the-dataset">
<span class="header-section-number">8.3</span> First check of the dataset</h2>
<p>By typing <code>raw_traits</code> in the console it will display the first rows and columns of the dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span>
<span class="co">#&gt; # A tibble: 11,346 × 12</span>
<span class="co">#&gt;    Date       Gradient  Site PlotID Individual_nr ID      Taxon    Trait   Value</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-07-20 B            5 D                  1 AIB1395 saxifra… Plan… 6.5 e+0</span>
<span class="co">#&gt;  2 2018-07-20 B            5 D                  1 AIB1395 saxifra… Wet_… 2.92e-2</span>
<span class="co">#&gt;  3 2018-07-20 B            5 D                  1 AIB1395 saxifra… Dry_… 4   e-3</span>
<span class="co">#&gt;  4 2018-07-20 B            5 D                  1 AIB1395 saxifra… Leaf… 5.66e-1</span>
<span class="co">#&gt;  5 2018-07-20 B            5 D                  1 AIB1395 saxifra… Leaf… 6.75e-1</span>
<span class="co">#&gt;  6 2018-07-20 B            5 D                  1 AIB1395 saxifra… SLA_… 1.69e+2</span>
<span class="co">#&gt;  7 2018-07-20 B            5 D                  1 AIB1395 saxifra… LDMC  1.37e-1</span>
<span class="co">#&gt;  8 2018-07-20 B            5 D                  1 AIB1395 saxifra… C_pe… 3.89e+1</span>
<span class="co">#&gt;  9 2018-07-20 B            5 D                  1 AIB1395 saxifra… N_pe… 1.14e+0</span>
<span class="co">#&gt; 10 2018-07-20 B            5 D                  1 AIB1395 saxifra… CN_r… 3.41e+1</span>
<span class="co">#&gt; # … with 11,336 more rows, and 3 more variables: Elevation_m &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Latitude_N &lt;dbl&gt;, Longitude_E &lt;dbl&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the top you can see that the dataset has 11346 observations and 12 columns. These numbers give you a first impression if you have imported the right file, and if all your observations and columns are there.</p>
<section id="check-the-data-type" class="level3" data-number="8.3.1"><h3 data-number="8.3.1" class="anchored" data-anchor-id="check-the-data-type">
<span class="header-section-number">8.3.1</span> Check the data type</h3>
<p>The next thing to check is if the variables have the right data type (or class in R terminology). For each variable the output indicates the data type. The most common types are <em>dbl</em> (numeric or integer), <em>chr</em> (character), or <em>date</em> (date).</p>
<p>If you want to know more about data types see <a href="https://biostats-r.github.io/biostats/workingInR/first-steps-in-r.html#data-types-and-objects">here</a>.</p>
<p>Now we want to check if the variables have the right data type. The first variable <em>Date</em> is a character, which is not correct. This probably means that one or several observations have a wrong date. Let us check all different values for the variable <em>Date</em>. For this we can use the function <code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code> on the variable <em>Date</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>
<span class="co">#&gt; distinct: removed 11,338 rows (&gt;99%), 8 rows remaining</span>
<span class="co">#&gt; # A tibble: 8 × 1</span>
<span class="co">#&gt;   Date      </span>
<span class="co">#&gt;   &lt;chr&gt;     </span>
<span class="co">#&gt; 1 2018-07-20</span>
<span class="co">#&gt; 2 2018-07-18</span>
<span class="co">#&gt; 3 2018-07-21</span>
<span class="co">#&gt; 4 2018-07-24</span>
<span class="co">#&gt; 5 2018-07-19</span>
<span class="co">#&gt; 6 2018-07-17</span>
<span class="co">#&gt; 7 18        </span>
<span class="co">#&gt; 8 &lt;NA&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see that there are 6 distinct dates in this variable. One of the dates is “18”, which is not a correct date format and turned the variable into a character. Note that the additional information from the tidylog package about the <code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code> function. It shows the number of rows removed and remaining.</p>
<p>The next step is to check where the problem occurred. For this we can use the function <code><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter()</a></code> to extract all observations with the date 18. We can use <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> to display the whole table.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">==</span> <span class="st">"18"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<pre><code>#&gt; filter: removed 11,339 rows (&gt;99%), 7 rows remaining
#&gt; # A tibble: 7 × 12
#&gt;   Date  Gradient  Site PlotID Individual_nr ID      Taxon         Trait    Value
#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt;
#&gt; 1 18    C            1 A                  3 AMO3822 salix polaris Plant… 1.1 e+0
#&gt; 2 18    C            1 A                  3 AMO3822 salix polaris Wet_M… 5.76e-3
#&gt; 3 18    C            1 A                  3 AMO3822 salix polaris Dry_M… 2   e-3
#&gt; 4 18    C            1 A                  3 AMO3822 salix polaris Leaf_… 1.88e-1
#&gt; 5 18    C            1 A                  3 AMO3822 salix polaris Leaf_… 2.84e-1
#&gt; 6 18    C            1 A                  3 AMO3822 salix polaris SLA_c… 1.42e+2
#&gt; 7 18    C            1 A                  3 AMO3822 salix polaris LDMC   3.47e-1
#&gt; # … with 3 more variables: Elevation_m &lt;dbl&gt;, Latitude_N &lt;dbl&gt;,
#&gt; #   Longitude_E &lt;dbl&gt;</code></pre>
</div>
<p>We see that it is a single observation (with multiple traits) that has the wrong date. The next step is to check the raw data, notes, photos, etc. to find the correct date for this observations. It is important to keep the data entry sheets, take a photo of them and keep the field notes to be able to fix such problems.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">#knitr::include_graphics("images/resource/...")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- Change this sentence once the photo is in! -->
<p>Since the value for date is 18, we will assume now that this was a typo and that the correct date is 2018-07-18. Let’s replace this value and give the variable the right class.</p>
<p>For this we will use the function <code><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate()</a></code> which adds or manipulates a column. Inside the mutate we will use the <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> function to replace the date for a specific ID. We are using the function with a single statement, however this is a powerful function that allow for multiple statements (many if else conditions). To give the variable the correct class, we use the <code>ymd()</code> function from the lubridate package. Note that we now have to assign the table to a new or the same name to make the change permanent.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="st">"AMO3822"</span> <span class="op">~</span> <span class="st">"2018-07-18"</span>,
                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Date</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span> Date <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; mutate: changed 7 values (&lt;1%) of 'Date' (0 new NA)</span>
<span class="co">#&gt; mutate: converted 'Date' from character to Date (0 new NA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An important step when cleaning data is to check that you have done the right thing. The <strong>tidylog</strong> functions show that for 7 observation Date has been changed. This matches with the number of observations that had a wrong date.</p>
<p>To be sure we can look at the specific leaf (ID == “AMO3822”) and see if the date is now corrected. Another way would be to run the <code>distinct(Date)</code> function again.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="st">"AMO3822"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>
<span class="co">#&gt; filter: removed 11,339 rows (&gt;99%), 7 rows remaining</span>
<span class="co">#&gt; select: dropped 11 variables (Gradient, Site, PlotID, Individual_nr, ID, …)</span>
<span class="co">#&gt; # A tibble: 7 × 1</span>
<span class="co">#&gt;   Date      </span>
<span class="co">#&gt;   &lt;date&gt;    </span>
<span class="co">#&gt; 1 2018-07-18</span>
<span class="co">#&gt; 2 2018-07-18</span>
<span class="co">#&gt; 3 2018-07-18</span>
<span class="co">#&gt; 4 2018-07-18</span>
<span class="co">#&gt; 5 2018-07-18</span>
<span class="co">#&gt; 6 2018-07-18</span>
<span class="co">#&gt; 7 2018-07-18</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The date has been fixed.</p>
</section></section><section id="exercise" class="level2 unnumbered exercise toc-ignore"><h2 class="unnumbered exercise toc-ignore anchored" data-anchor-id="exercise">Exercise</h2>
<p>Now it is your turn. Check if the data type for the variable <em>Date</em> is now correct.</p>
<details><summary>
Hint
</summary><ul>
<li>type <code>raw_traits</code> to look at the whole dataset where the datatype of each variable is indicated</li>
<li>use <code>class(raw_traits$Date)</code> which will tell you directly what type of class the variable has</li>
<li>use <code>map(raw_traits, class)</code> to get the class of all variable in the dataframe</li>
</ul></details></section><section id="check-for-duplicates" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="check-for-duplicates">
<span class="header-section-number">8.4</span> Check for duplicates</h2>
<p>Another common problem is duplicate observations. This can happen when data is entered twice. The why to find duplicates is to check that the combination of variables are unique. In our dataset, we expect that <em>Date</em>, <em>Gradient</em>, <em>Site</em>, <em>PlotID</em>, <em>Individual_nr</em>, <em>ID</em>, <em>Taxon</em> and <em>Trait</em> should be unique, and only occurring once.</p>
<p>To check this, we can <code><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by()</a></code> these variables and <code><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter()</a></code> for observations that occur more than once.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Gradient</span>, <span class="va">Site</span>, <span class="va">PlotID</span>, <span class="va">Individual_nr</span>, <span class="va">ID</span>, <span class="va">Taxon</span>, <span class="va">Trait</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; group_by: 8 grouping variables (Date, Gradient, Site, PlotID, Individual_nr, …)</span>
<span class="co">#&gt; filter (grouped): removed 11,344 rows (&gt;99%), 2 rows remaining</span>
<span class="co">#&gt; # A tibble: 2 × 12</span>
<span class="co">#&gt; # Groups:   Date, Gradient, Site, PlotID, Individual_nr, ID, Taxon, Trait [1]</span>
<span class="co">#&gt;   Date       Gradient  Site PlotID Individual_nr ID      Taxon     Trait   Value</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2018-07-20 B            3 C                  3 BEK3638 salix po… Dry_… 0.00275</span>
<span class="co">#&gt; 2 2018-07-20 B            3 C                  3 BEK3638 salix po… Dry_… 0.00275</span>
<span class="co">#&gt; # … with 3 more variables: Elevation_m &lt;dbl&gt;, Latitude_N &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Longitude_E &lt;dbl&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is one duplicate entry.</p>
<p>Note that <em>Value</em> was not included in the <code><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by()</a></code>. This was done intentionally, because a common mistake is to have a duplicate, but with a different value. This is either because one of the variables is wrong, e.g.&nbsp;it has the wrong Site and therefore appears to be a duplicate. Alternatively, the leaf could have been measured twice by accident, which would likely give two slightly different values. When getting a duplicate, these different options for why there is a duplicate have to be considered and carefully checked in the raw data.</p>
<p>In this case, we will assume that the leaf has only been measured once, but the data has been entered twice. Thus, the two entries are exact duplicates.</p>
<p>To fix the duplicate problem, we group by the variables we expect to be unique. Then we use <code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code> with the argument <em>.keep_all = TRUE</em> to remove the duplicates.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits2</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Gradient</span>, <span class="va">Site</span>, <span class="va">PlotID</span>, <span class="va">Individual_nr</span>, <span class="va">ID</span>, <span class="va">Taxon</span>, <span class="va">Trait</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span>.keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; group_by: 8 grouping variables (Date, Gradient, Site, PlotID, Individual_nr, …)</span>
<span class="co">#&gt; distinct (grouped): removed one row (&lt;1%), 11,345 rows remaining</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tidylog allows us to see what happens and how many rows have been removed. There are 8 grouping variables and as expected, one row is filtered away, which is the duplicated row.</p>
<p>We can also run the code from above again to check if the duplicate is gone.</p>
</section><section id="check-for-missing-data" class="level2" data-number="8.5"><h2 data-number="8.5" class="anchored" data-anchor-id="check-for-missing-data">
<span class="header-section-number">8.5</span> Check for missing data</h2>
<p>A common problem in a dataset are missing values.</p>
<p>How to detect missing values…</p>
<p>Once the missing values are detected one has to decide if the missing data can be recovered, or if the missing values should be removed from the dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>
<span class="co">#&gt; drop_na: removed 3 rows (&lt;1%), 11,343 rows remaining</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This operation has removed 3 rows, which is the number of NA’s in the dataset.</p>
<section id="check-values-within-variables" class="level3" data-number="8.5.1"><h3 data-number="8.5.1" class="anchored" data-anchor-id="check-values-within-variables">
<span class="header-section-number">8.5.1</span> Check values within variables</h3>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Taxon</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Taxon</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>
<span class="co">#&gt; distinct: removed 11,299 rows (&gt;99%), 44 rows remaining</span>
<span class="co">#&gt; # A tibble: 44 × 1</span>
<span class="co">#&gt;    Taxon                   </span>
<span class="co">#&gt;    &lt;chr&gt;                   </span>
<span class="co">#&gt;  1 alopecurus ovatus       </span>
<span class="co">#&gt;  2 aulacomnium turgidum    </span>
<span class="co">#&gt;  3 bistorta vivipara       </span>
<span class="co">#&gt;  4 calamagrostis neglecta  </span>
<span class="co">#&gt;  5 cassiope tetragona      </span>
<span class="co">#&gt;  6 cerastium arcticum      </span>
<span class="co">#&gt;  7 dicranum sp             </span>
<span class="co">#&gt;  8 draba arctica           </span>
<span class="co">#&gt;  9 draba oxycarpa          </span>
<span class="co">#&gt; 10 dryas octopetala        </span>
<span class="co">#&gt; 11 equisetum arvense       </span>
<span class="co">#&gt; 12 equisetum scirpoides    </span>
<span class="co">#&gt; 13 festuca rubra           </span>
<span class="co">#&gt; 14 festuca viviparoidea    </span>
<span class="co">#&gt; 15 hylocomium splendens    </span>
<span class="co">#&gt; 16 luzula confusa          </span>
<span class="co">#&gt; 17 luzula nivalis          </span>
<span class="co">#&gt; 18 micranthes hieraciifolia</span>
<span class="co">#&gt; 19 micranthes nivalis      </span>
<span class="co">#&gt; 20 niphotrichum canescens  </span>
<span class="co">#&gt; 21 niphotrichum sp         </span>
<span class="co">#&gt; 22 oxiria digyna           </span>
<span class="co">#&gt; 23 oxyra digyna            </span>
<span class="co">#&gt; 24 oxyria digina           </span>
<span class="co">#&gt; 25 oxyria digyna           </span>
<span class="co">#&gt; 26 pedicularis hirsuta     </span>
<span class="co">#&gt; 27 poa alpina              </span>
<span class="co">#&gt; 28 poa arctica             </span>
<span class="co">#&gt; 29 poa pratensis           </span>
<span class="co">#&gt; 30 polytrichum piliferum   </span>
<span class="co">#&gt; 31 polytrichum sp          </span>
<span class="co">#&gt; 32 potentilla hyparctica   </span>
<span class="co">#&gt; 33 ranunculus sulphureus   </span>
<span class="co">#&gt; 34 salix polaris           </span>
<span class="co">#&gt; 35 sanionia sp             </span>
<span class="co">#&gt; 36 saxifraga cernua        </span>
<span class="co">#&gt; 37 saxifraga cespitosa     </span>
<span class="co">#&gt; 38 saxifraga hirculus      </span>
<span class="co">#&gt; 39 saxifraga oppositifolia </span>
<span class="co">#&gt; 40 silene acaulis          </span>
<span class="co">#&gt; 41 stellaria longipes      </span>
<span class="co">#&gt; 42 syntrichia ruralis      </span>
<span class="co">#&gt; 43 tomentypnum nitens      </span>
<span class="co">#&gt; 44 trisetum spicatum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4 different versions of <em>oxyra digyna</em>! rename alternative would be to use a dictionary.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>Taxon <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">Taxon</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oxiria digyna"</span>, <span class="st">"oxyria digina"</span>, <span class="st">"oxyra digyna"</span><span class="op">)</span>, <span class="st">"oxyria digyna"</span>, <span class="va">Taxon</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; mutate: changed 28 values (&lt;1%) of 'Taxon' (0 new NA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="visualise-data" class="level2" data-number="8.6"><h2 data-number="8.6" class="anchored" data-anchor-id="visualise-data">
<span class="header-section-number">8.6</span> Visualise data</h2>
<p>Some errors and problems in the data are difficult to detect. Checking if the measurements are realistic is nearly impossible by looking at a dataframe. For this, visualising the data is much more effective.</p>
<p>Make histograms, this shows the range of the values</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Value</span>, fill <span class="op">=</span> <span class="va">Gradient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green4"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8_data_curation_files/figure-html/hist-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the size traits (height, mass, area and thickness) have very long tails. It is common to log transform such variables to better see the full range of the variables.</p>
<p>Leaf area has a huge tail and goes up to almost 20’000 cm<sup>2</sup>. This would be a leaf of almost 2 m<sup>2</sup>, which is nearly impossible. This value needs to be checked, it could be a typo.</p>
<p>Let’s log transform the size traits.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R">
<span class="va">raw_traits</span> <span class="op">&lt;-</span> <span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"Plant_Height_cm"</span>,
    <span class="st">"Wet_Mass_g"</span>,
    <span class="st">"Dry_Mass_g"</span>,
    <span class="st">"Leaf_Area_cm2"</span>,
    <span class="st">"Leaf_Thickness_mm"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>, <span class="va">Value</span><span class="op">)</span>,
    Trait <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">Trait</span>,
                   <span class="st">"Plant_Height_cm"</span> <span class="op">=</span> <span class="st">"Plant_Height_cm_log"</span>,
                   <span class="st">"Wet_Mass_g"</span> <span class="op">=</span> <span class="st">"Wet_Mass_g_log"</span>,
                   <span class="st">"Dry_Mass_g"</span> <span class="op">=</span> <span class="st">"Dry_Mass_g_log"</span>,
                   <span class="st">"Leaf_Area_cm2"</span> <span class="op">=</span> <span class="st">"Leaf_Area_cm2_log"</span>,
                   <span class="st">"Leaf_Thickness_mm"</span> <span class="op">=</span> <span class="st">"Thickness_mm_log"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in log(Value): NaNs produced</span>
<span class="co">#&gt; mutate: changed 5,428 values (48%) of 'Trait' (0 new NA)</span>
<span class="co">#&gt;         changed 5,428 values (48%) of 'Value' (0 new NA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And make plot again.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Value</span>, fill <span class="op">=</span> <span class="va">Gradient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green4"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8_data_curation_files/figure-html/hist-log-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The size traits are now easier to read.</p>
<p>Another way to check the data is to plot correlated values against each other. In this dataset, we can plot dry mass against leaf area. We would expect a positive correlation between the two variables, where large leaves have a higher dry mass.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">raw_traits</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">Trait</span>, values_from <span class="op">=</span> <span class="va">Value</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dry_Mass_g_log</span>, y <span class="op">=</span> <span class="va">Leaf_Area_cm2_log</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./7_reproducible.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./9_community.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plant community composition data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>